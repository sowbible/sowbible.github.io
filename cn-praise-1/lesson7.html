<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>7ê³¼. èµç¾ï¼Œèµç¾ Â· ì°¬ì–‘í•´, ì°¬ì–‘í•´</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      background: #f7f9fc;
      font-size: 24px;
      color: #111;
    }
    h1 {
      font-size: 48px;
      margin-bottom: 16px;
      color: #000;
    }

    /* ìƒë‹¨ í° íƒ­ (1~5) */
    .step-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }
    .step-tab {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #fed7aa;
      font-size: 24px;
      color: #7c2d12;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .step-tab.active {
      background: #f97316;
      color: #fff;
      box-shadow: 0 0 0 2px #ffedd5 inset;
    }

    /* íŒŒë€ ì†Œíƒ­ (ëª¨ë“œ íƒ­) */
    .mode-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }
    .mode-tab {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #e0e7ff;
      font-size: 20px;
      color: #111827;
    }
    .mode-tab.active {
      background: #2563eb;
      color: #fff;
    }

    .card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    .section-label {
      font-size: 20px;
      color: #374151;
      margin-bottom: 8px;
    }

    .zh {
      font-size: 44px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #b91c1c;
    }
    .pinyin {
      font-size: 26px;
      color: #444;
    }
    .ko {
      font-size: 26px;
      color: #222;
      margin-bottom: 14px;
      white-space: pre-line;
    }
    .hint {
      font-size: 22px;
      color: #555;
      margin-top: 10px;
    }

    button {
      padding: 10px 20px;
      font-size: 22px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 8px;
      background: #2563eb;
      color: white;
    }
    button.secondary { background: #10b981; }
    button.ghost { background: #e5e7eb; color: #1f2937; }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    /* ë§ì”€ ì¹´ë“œ */
    .verse-card {
      background: linear-gradient(135deg, #fef3c7, #e0f2fe);
      border-left: 6px solid #f97316;
    }
    .verse-ref {
      font-size: 24px;
      color: #555;
      margin-bottom: 6px;
    }
    .verse-text {
      font-size: 26px;
      white-space: pre-line;
      color: #111;
    }

    /* í”Œë˜ì‹œ ì¹´ë“œ */
    .flash-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 12px;
    }
    .flashcard {
      min-height: 220px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #ffedd5, #fed7aa);
      border-radius: 20px;
      cursor: pointer;
      text-align: center;
      padding: 24px;
      position: relative;
      transition: background 0.25s ease;
    }
    .flashcard.back {
      background: linear-gradient(135deg, #ecfdf5, #a5f3fc);
    }
    .flash-face {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .flash-counter {
      position: absolute;
      top: 10px;
      left: 14px;
      font-size: 18px;
      color: #374151;
      background: rgba(255,255,255,0.8);
      padding: 2px 10px;
      border-radius: 999px;
    }
    .flash-front {
      font-size: 72px;
      font-weight: bold;
      color: #b91c1c;
    }
    .flash-back-main {
      font-size: 34px;
      font-weight: bold;
      color: #000;
      margin-bottom: 6px;
    }
    .flash-back-sub {
      font-size: 22px;
      color: #333;
    }
    .idx-text {
      font-size: 22px;
      margin-top: 6px;
      color: #444;
      text-align: center;
    }
    .arrow-btn {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      font-size: 28px;
      color: #374151;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* í•˜ì´ë¼ì´íŠ¸ */
    .inline-a {
      background: #fef08a;
      padding: 0 4px;
      border-radius: 6px;
      box-shadow: 0 0 0 2px #fef08a inset;
    }
    .inline-b {
      background: #bbf7d0;
      padding: 0 4px;
      border-radius: 6px;
      box-shadow: 0 0 0 2px #86efac inset;
    }

    .mini-card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }
    .mini-card {
      border-radius: 14px;
      padding: 10px 14px;
      min-width: 150px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(15,23,42,0.12);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      background: #f9fafb;
    }
    .mini-card-a {
      background: #fef08a; /* ë…¸ë‘ */
    }
    .mini-card-b {
      background: #dcfce7; /* ì´ˆë¡ */
    }
    .mini-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(15,23,42,0.16);
      filter: brightness(1.03);
    }
    .mini-card-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #111827;
    }
    .mini-card-zh {
      font-size: 26px;
      color: #b91c1c;
      margin-bottom: 2px;
    }
    .mini-card-sub {
      font-size: 18px;
      color: #4b5563;
    }

    .template-box {
      background:#e0f2fe;
      padding:12px 16px;
      border-radius:12px;
      margin-bottom:8px;
    }

    /* ë§¤ì¹­ ê²Œì„ */
    .match-layout {
      display: flex;
      gap: 16px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .match-col {
      flex: 1;
      min-width: 180px;
    }
    .match-btn {
      display: block;
      width: 100%;
      margin-bottom: 8px;
      padding: 8px 14px;
      font-size: 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      text-align: left;
      background: #e5e7eb;
      color: #111827;
      transition: background 0.12s ease, transform 0.12s ease;
    }
    .match-btn:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }
    .match-btn.selected {
      background: #fee2e2;
    }
    .match-btn.correct {
      background: #bbf7d0;
      cursor: default;
    }
    .match-btn.wrong {
      background: #fecaca;
    }

    .table-card {
      margin-top: 8px;
      background:#f9fafb;
    }
  </style>
</head>

<body>
  <h1>7ê³¼. èµç¾ï¼Œèµç¾ Â· ì°¬ì–‘í•´, ì°¬ì–‘í•´</h1>

  <div id="step-tabs" class="step-tabs"></div>
  <div id="mode-tabs" class="mode-tabs"></div>
  <div id="content"></div>

  <script>
    /* ===== 0. ê³µí†µ ìœ í‹¸ & TTS / ë…¹ìŒ ===== */

    const recordings = {};

    function clear(el) {
      while (el.firstChild) el.removeChild(el.firstChild);
    }

    function shuffleArray(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    let zhVoices = [];
    let selectedZhVoice = null;

    function loadZhVoices() {
      if (!("speechSynthesis" in window)) return;
      const voices = window.speechSynthesis.getVoices();
      zhVoices = voices.filter(v =>
        (v.lang && v.lang.toLowerCase().startsWith("zh")) ||
        (v.lang && v.lang.toLowerCase().includes("hans")) ||
        (v.name && v.name.toLowerCase().includes("chinese"))
      );
      selectedZhVoice =
        zhVoices.find(v => v.lang && v.lang.toLowerCase() === "zh-cn") ||
        zhVoices[0] || null;
    }

    if ("speechSynthesis" in window) {
      loadZhVoices();
      window.speechSynthesis.onvoiceschanged = loadZhVoices;
    }

    function ensureChineseVoice() {
      if (!("speechSynthesis" in window)) {
        alert("ë¸Œë¼ìš°ì €ê°€ ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.");
        return false;
      }
      if (!selectedZhVoice) {
        alert(
          "ê¸°ê¸°ì—ì„œ ì¤‘êµ­ì–´ ìŒì„±ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”.\n" +
          "ì„¤ì •ì—ì„œ 'ì¤‘êµ­ì–´(Chinese, China)' ìŒì„±ì„ ì„¤ì¹˜í•´ ì£¼ì„¸ìš”."
        );
        return false;
      }
      return true;
    }

    function speakChineseOnce(text) {
      if (!ensureChineseVoice()) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang  = "zh-CN";
      u.voice = selectedZhVoice;
      u.rate  = 0.8;
      u.pitch = 1.0;
      window.speechSynthesis.speak(u);
    }

    function speakChineseFive(text) {
      if (!ensureChineseVoice()) return;
      window.speechSynthesis.cancel();
      let count = 0;
      function playOnce() {
        const u = new SpeechSynthesisUtterance(text);
        u.lang  = "zh-CN";
        u.voice = selectedZhVoice;
        u.rate  = 0.8;
        u.pitch = 1.0;
        u.onend = () => {
          count++;
          if (count < 5) setTimeout(playOnce, 300);
        };
        window.speechSynthesis.speak(u);
      }
      playOnce();
    }

    async function recordSentence(id, statusEl) {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë…¹ìŒì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.");
        return;
      }
      statusEl.textContent = "ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”. (ë¸Œë¼ìš°ì € ìƒë‹¨ í™•ì¸)";
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const rec = new MediaRecorder(stream);
        const chunks = [];
        rec.ondataavailable = e => chunks.push(e.data);
        rec.onstop = () => {
          const blob = new Blob(chunks, { type: "audio/webm" });
          recordings[id] = URL.createObjectURL(blob);
          statusEl.textContent = "ë…¹ìŒ ì™„ë£Œ! 'ë…¹ìŒ ë“£ê¸° â–¶'ë¥¼ ëˆŒëŸ¬ ë³´ì„¸ìš”.";
          stream.getTracks().forEach(t => t.stop());
        };
        rec.start();
        statusEl.textContent = "ë…¹ìŒ ì¤‘... ë”°ë¼ ë§í•´ ë³´ì„¸ìš”.";
        setTimeout(() => { if (rec.state !== "inactive") rec.stop(); }, 6000);
      } catch (e) {
        statusEl.textContent = "ë§ˆì´í¬ ê¶Œí•œì´ ê±°ì ˆë˜ì—ˆì–´ìš”.";
      }
    }

    function playRecording(id) {
      if (!recordings[id]) {
        alert("ì•„ì§ ë…¹ìŒì´ ì—†ì–´ìš”.");
        return;
      }
      const audio = new Audio(recordings[id]);
      audio.play();
    }

    /* ===== 1. 7ê³¼ ë°ì´í„° ===== */

    const verses7 = [
      {
        ref: "ì—ë² ì†Œì„œ 1:4-6",
        textKo:
"4 ê³§ ì°½ì„¸ ì „ì— ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œ ìš°ë¦¬ë¥¼ íƒí•˜ì‚¬ ìš°ë¦¬ë¡œ ì‚¬ë‘ ì•ˆì—ì„œ ê·¸ ì•ì—\nê±°ë£©í•˜ê³  í ì´ ì—†ê²Œ í•˜ì‹œë ¤ê³ \n" +
"5 ê·¸ ê¸°ì˜ì‹  ëœ»ëŒ€ë¡œ ìš°ë¦¬ë¥¼ ì˜ˆì •í•˜ì‚¬ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ë¡œ ë§ë¯¸ì•”ì•„ ìê¸°ì˜ ì•„ë“¤ë“¤ì´ ë˜ê²Œ í•˜ì…¨ìœ¼ë‹ˆ\n" +
"6 ì´ëŠ” ê·¸ê°€ ì‚¬ë‘í•˜ì‹œëŠ” ì ì•ˆì—ì„œ ìš°ë¦¬ì—ê²Œ ê±°ì € ì£¼ì‹œëŠ” ë°” ê·¸ì˜ ì€í˜œì˜\nì˜ê´‘ì„ ì°¬ë¯¸í•˜ê²Œ í•˜ë ¤ëŠ” ê²ƒì´ë¼"
      },
      {
        ref: "ì‹œí¸ 150:6",
        textKo: "í˜¸í¡ì´ ìˆëŠ” ìë§ˆë‹¤ ì—¬í˜¸ì™€ë¥¼ ì°¬ì–‘í• ì§€ì–´ë‹¤ í• ë ë£¨ì•¼!"
      },
      {
        ref: "ì‹œí¸ 34:1",
        textKo: "ë‚´ê°€ ì—¬í˜¸ì™€ë¥¼ í•­ìƒ ì†¡ì¶•í•¨ì´ì—¬ ê·¸ë¥¼ ì°¬ì–‘í•¨ì´ ë‚´ ì…ì— í•­ìƒ ìˆë„ë‹¤"
      }
    ];

    // 7-1 ì§§ì€ í›„ë ´ (í•œ ì¤„)
    const shortChant = {
      zh: "èµç¾ï¼Œèµç¾",
      pinyin: "zÃ nmÄ›i, zÃ nmÄ›i",
      ko: "ì°¬ì–‘í•´, ì°¬ì–‘í•´"
    };

    // 7-2 ê°€ì‚¬ 3ë¬¸ì¥
    const fullLyrics7 = [
      {
        zh: "æ—©æ™¨èµç¾è€¶ç¨£ã€‚",
        pinyin: "zÇochÃ©n zÃ nmÄ›i yÄ“sÅ«",
        ko: "ì•„ì¹¨ì— ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´."
      },
      {
        zh: "ä¸­åˆèµç¾è€¶ç¨£ã€‚",
        pinyin: "zhÅngwÇ” zÃ nmÄ›i yÄ“sÅ«",
        ko: "ì ì‹¬ì— ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´."
      },
      {
        zh: "æ™šä¸Šèµç¾ä¸»è€¶ç¨£ã€‚",
        pinyin: "wÇnshÃ ng zÃ nmÄ›i zhÇ” yÄ“sÅ«",
        ko: "ë°¤ì— ì£¼ ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´."
      }
    ];

    const vocabPraise7 = [
      { hanzi: "èµç¾", pinyin: "zÃ nmÄ›i", meaning: "ì°¬ì–‘í•˜ë‹¤" },
      { hanzi: "æ—©æ™¨", pinyin: "zÇochÃ©n", meaning: "ì•„ì¹¨(ì´ë¥¸ ì•„ì¹¨)" },
      { hanzi: "ä¸­åˆ", pinyin: "zhÅngwÇ”", meaning: "ì ì‹¬, ì •ì˜¤" },
      { hanzi: "æ™šä¸Š", pinyin: "wÇnshÃ ng", meaning: "ì €ë…, ë°¤" },
      { hanzi: "ä¸»",   pinyin: "zhÇ”",     meaning: "ì£¼, ì£¼ë‹˜" },
      { hanzi: "è€¶ç¨£", pinyin: "yÄ“sÅ«",    meaning: "ì˜ˆìˆ˜ë‹˜" }
    ];

    const timeWords7 = [
      { hanzi: "æ—©ä¸Š", pinyin: "zÇoshang", meaning: "ì•„ì¹¨ (6~9ì‹œ)" },
      { hanzi: "æ—©æ™¨", pinyin: "zÇochÃ©n",  meaning: "ì´ë¥¸ ì•„ì¹¨ (5~8ì‹œ)" },
      { hanzi: "ä¸Šåˆ", pinyin: "shÃ ngwÇ”",  meaning: "ì˜¤ì „ (9~12ì‹œ)" },
      { hanzi: "ä¸­åˆ", pinyin: "zhÅngwÇ”",  meaning: "ì •ì˜¤~ì˜¤í›„ 1ì‹œ" },
      { hanzi: "ä¸‹åˆ", pinyin: "xiÃ wÇ”",    meaning: "ì˜¤í›„ (1~6ì‹œ)" },
      { hanzi: "æ™šä¸Š", pinyin: "wÇnshÃ ng", meaning: "ì €ë…, ë°¤" }
    ];

    const greetingWords7 = [
      { hanzi: "ä½ å¥½",     pinyin: "nÇ hÇo",         meaning: "ì•ˆë…•" },
      { hanzi: "æ‚¨å¥½",     pinyin: "nÃ­n hÇo",        meaning: "ì•ˆë…•í•˜ì„¸ìš” (ì¡´ì¹­)" },
      { hanzi: "å—¨",       pinyin: "hÄi",           meaning: "í•˜ì´ (ì¹œêµ¬ë¼ë¦¬)" },
      { hanzi: "å†è§",     pinyin: "zÃ ijiÃ n",       meaning: "ë˜ ë´ìš”" },
      { hanzi: "æ—©ä¸Šå¥½",   pinyin: "zÇoshang hÇo",  meaning: "ì¢‹ì€ ì•„ì¹¨" },
      { hanzi: "æ™šä¸Šå¥½",   pinyin: "wÇnshÃ ng hÇo",  meaning: "ì¢‹ì€ ì €ë…" },
      { hanzi: "æ™šå®‰",     pinyin: "wÇn Än",        meaning: "ì˜ ììš”" }
    ];

    // A/Bìš© ì‚¬ëŒ(ì£¼ì–´) ë¦¬ìŠ¤íŠ¸
    const subjects7 = [
      { zh: "æˆ‘",   pinyin: "wÇ’",      ko: "ë‚˜" },
      { zh: "ä½ ",   pinyin: "nÇ",      ko: "ë„ˆ" },
      { zh: "ä»–",   pinyin: "tÄ",      ko: "ê·¸" },
      { zh: "å¥¹",   pinyin: "tÄ",      ko: "ê·¸ë…€" },
      { zh: "æˆ‘ä»¬", pinyin: "wÇ’men",  ko: "ìš°ë¦¬" },
      { zh: "ä½ ä»¬", pinyin: "nÇmen",   ko: "ë„ˆí¬" },
      { zh: "ä»–ä»¬", pinyin: "tÄmen",   ko: "ê·¸ë“¤" }
    ];

    // 5íƒ­ í€´ì¦ˆ (ì¶”ê°€ í¬í•¨)
    const quizItems7 = [
      {
        id: "7-5-1",
        ko: "ì•„ì¹¨ì— ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´.",
        zh: "æ—©æ™¨èµç¾è€¶ç¨£ã€‚",
        py: "zÇochÃ©n zÃ nmÄ›i yÄ“sÅ«"
      },
      {
        id: "7-5-2",
        ko: "ì ì‹¬ì— ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´.",
        zh: "ä¸­åˆèµç¾è€¶ç¨£ã€‚",
        py: "zhÅngwÇ” zÃ nmÄ›i yÄ“sÅ«"
      },
      {
        id: "7-5-3",
        ko: "ë°¤ì— ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´.",
        zh: "æ™šä¸Šèµç¾ä¸»è€¶ç¨£ã€‚",
        py: "wÇnshÃ ng zÃ nmÄ›i zhÇ” yÄ“sÅ«"
      },
      {
        id: "7-5-4",
        ko: "ì¢‹ì€ ì•„ì¹¨!",
        zh: "æ—©ä¸Šå¥½ï¼",
        py: "zÇoshang hÇo"
      },
      {
        id: "7-5-5",
        ko: "ì˜ ììš”.",
        zh: "æ™šå®‰ï¼",
        py: "wÇn Än"
      },
      {
        id: "7-5-6",
        ko: "ì•ˆë…•!",
        zh: "ä½ å¥½ï¼",
        py: "nÇ hÇo"
      },
      {
        id: "7-5-7",
        ko: "ì¢‹ì€ ì €ë…!",
        zh: "æ™šä¸Šå¥½ï¼",
        py: "wÇnshÃ ng hÇo"
      },
      {
        id: "7-5-8",
        ko: "ë˜ ë´ìš”.",
        zh: "å†è§ã€‚",
        py: "zÃ ijiÃ n"
      }
    ];

    const lesson7 = {
      steps: [
        {
          id: "7-1",
          label: "1",
          title: "7-1 ë§ì”€ê³¼ ì°¬ì–‘",
          description: "ì§§ì€ í›„ë ´ â€˜èµç¾ï¼Œèµç¾â€™ë¥¼ ë°°ìš°ê³ , ë§ì”€ ì†ì—ì„œ í•˜ë‚˜ë‹˜ ì„±í’ˆì„ ì°¾ì•„ë³´ì•„ìš”.",
          verses: verses7
        },
        {
          id: "7-2",
          label: "2",
          title: "7-2 ì°¬ì–‘ Â· èµç¾ï¼Œèµç¾",
          description: "ì•„ì¹¨Â·ì ì‹¬Â·ì €ë…ì— ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•˜ëŠ” ì„¸ ë¬¸ì¥ì„ ë°°ì›Œìš”.",
          lyrics: fullLyrics7,
          vocab: vocabPraise7,
          verses: [verses7[1]]
        },
        {
          id: "7-3",
          label: "3",
          title: "7-3 ì‹œê°„ í‘œí˜„ 1 Â· (A)(B)è¦èµç¾è€¶ç¨£",
          description: "â€˜ì–¸ì œ, ëˆ„ê°€ ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•´ìš”?â€™ A(ì‹œê°„), B(ì‚¬ëŒ)ë¥¼ ê³¨ë¼ ë¬¸ì¥ì„ ë§Œë“¤ì–´ìš”.",
          verses: [verses7[1]]
        },
        {
          id: "7-4",
          label: "4",
          title: "7-4 ì‹œê°„ í‘œí˜„ 2 Â· (A)(B)è¦æ„Ÿè°¢æˆ‘ç¥",
          description: "â€˜ì–¸ì œ, ëˆ„ê°€ í•˜ë‚˜ë‹˜ê»˜ ê°ì‚¬í•´ìš”?â€™ A(ì‹œê°„), B(ì‚¬ëŒ)ë¥¼ ê³¨ë¼ ë¬¸ì¥ì„ ë§Œë“¤ì–´ìš”.",
          verses: [
            {
              ref: "ì‹œí¸ 136:1",
              textKo: "ì—¬í˜¸ì™€ê»˜ ê°ì‚¬í•˜ë¼ ê·¸ëŠ” ì„ í•˜ì‹œë©° ê·¸ ì¸ìí•˜ì‹¬ì´ ì˜ì›í•¨ì´ë¡œë‹¤"
            }
          ]
        },
        {
          id: "7-5",
          label: "5",
          title: "7-5 ì‹œê°„ í‘œí˜„ 3 Â· ì¸ì‚¬ & ë³µìŠµ í€´ì¦ˆ",
          description: "ì•„ì¹¨Â·ì €ë… ì¸ì‚¬ì™€ ì°¬ì–‘ ë¬¸ì¥ì„ ë³µìŠµí•˜ê³  í€´ì¦ˆë¡œ í™•ì¸í•´ìš”.",
          verses: [verses7[1], verses7[2]],
          quiz: quizItems7
        }
      ]
    };

    const modesBase7 = [
      { id: "study", label: "í•™ìŠµ ë¬¸ì¥" },
      { id: "attr",  label: "ë§ì”€ ì¹´ë“œ" },
      { id: "flash", label: "í”Œë˜ì‹œ ì¹´ë“œ" },
      { id: "quiz",  label: "í€´ì¦ˆ" },
      { id: "verse", label: "ë§ì”€ ì¹´ë“œ" }
    ];

    function getStepModes(step) {
      if (!step) return ["study"];
      if (step.id === "7-1") return ["study", "attr", "flash"]; // 1íƒ­: í•™ìŠµë¬¸ì¥ / ë§ì”€ ì¹´ë“œ / í”Œë˜ì‹œ
      if (step.id === "7-2") return ["study", "flash", "verse"];
      if (step.id === "7-3") return ["study", "flash", "verse"];
      if (step.id === "7-4") return ["study", "flash", "verse"];
      if (step.id === "7-5") return ["study", "quiz", "flash", "verse"];
      return ["study"];
    }

    function getFlashVocab(step) {
      if (!step) return [];
      if (step.id === "7-1" || step.id === "7-2") return vocabPraise7;
      if (step.id === "7-3" || step.id === "7-4") return timeWords7;
      if (step.id === "7-5") return greetingWords7;
      return [];
    }

    const stepTabsEl = document.getElementById("step-tabs");
    const modeTabsEl = document.getElementById("mode-tabs");
    const contentEl  = document.getElementById("content");

    let currentStepId = "7-1";
    let currentModeId = "study";

    function getCurrentStep() {
      return lesson7.steps.find(s => s.id === currentStepId);
    }

    /* ===== 2. ëª¨ë“œë³„ ë Œë”ë§ ===== */

    function renderStudy(step, container) {
      clear(container);

      // 7-1: ì§§ì€ í›„ë ´ í•œ ì¤„ë§Œ
      if (step.id === "7-1") {
        const chantCard = document.createElement("div");
        chantCard.className = "card";
        chantCard.innerHTML = `
          <div class="section-label">ì§§ì€ í›„ë ´ Â· èµç¾ï¼Œèµç¾</div>
          <div class="zh">${shortChant.zh}</div>
          <div class="pinyin">${shortChant.pinyin}</div>
          <div class="ko">${shortChant.ko}</div>
          <div class="btn-row">
            <button onclick="speakChineseOnce('èµç¾ï¼Œèµç¾')">í•œë²ˆ ë“£ê¸° â–¶</button>
            <button class="secondary" onclick="speakChineseFive('èµç¾ï¼Œèµç¾')">ë‹¤ì„¯ ë²ˆ ë“£ê¸° â–¶â–¶</button>
          </div>
          <div class="hint">
            â€˜èµç¾ï¼Œèµç¾â€™ë¥¼ ë¦¬ë“¬ì— ë§ì¶° ê³„ì† ë”°ë¼ ë§í•´ ë³´ì•„ìš”.<br/>
            ì…ì— ìì—°ìŠ¤ëŸ½ê²Œ ë¶™ì„ ë•Œê¹Œì§€ ë°˜ë³µí•˜ê¸°!
          </div>
        `;
        container.appendChild(chantCard);
        return;
      }

      // 7-2: ë¬¸ì¥ 3ê°œ
      if (step.id === "7-2") {
        const intro = document.createElement("div");
        intro.className = "card";
        intro.innerHTML = `
          <div class="section-label">${step.title} Â· í•™ìŠµ ë¬¸ì¥</div>
          <div class="ko">${step.description || ""}</div>
        `;
        container.appendChild(intro);

        (step.lyrics || fullLyrics7).forEach((s, idx) => {
          const block = document.createElement("div");
          block.className = "card";
          block.innerHTML = `
            <div class="section-label">ë¬¸ì¥ ${idx + 1}</div>
            <div class="zh">${s.zh}</div>
            <div class="pinyin">${s.pinyin}</div>
            <div class="ko">${s.ko}</div>
            <div class="btn-row">
              <button id="lyric-once-${idx}">í•œë²ˆ ë“£ê¸° â–¶</button>
              <button class="secondary" id="lyric-five-${idx}">ë‹¤ì„¯ ë²ˆ ë“£ê¸° â–¶â–¶</button>
            </div>
          `;
          container.appendChild(block);
          document.getElementById(`lyric-once-${idx}`).onclick = () => speakChineseOnce(s.zh);
          document.getElementById(`lyric-five-${idx}`).onclick = () => speakChineseFive(s.zh);
        });

        const vocabCard = document.createElement("div");
        vocabCard.className = "card table-card";
        vocabCard.innerHTML = `
          <div class="section-label">ë‹¨ì–´ ì •ë¦¬</div>
          <div class="ko">ì°¬ì–‘ì— ë‚˜ì˜¤ëŠ” ë‹¨ì–´ë¥¼ í•œ ë²ˆ ë” í™•ì¸í•´ìš”.</div>
        `;
        const tableWrap = document.createElement("div");
        tableWrap.className = "mini-card-container";
        (step.vocab || vocabPraise7).forEach(v => {
          const c = document.createElement("div");
          c.className = "mini-card";
          c.innerHTML = `
            <div class="mini-card-title">${v.meaning}</div>
            <div class="mini-card-zh">${v.hanzi}</div>
            <div class="mini-card-sub">${v.pinyin}</div>
          `;
          c.onclick = () => speakChineseOnce(v.hanzi);
          tableWrap.appendChild(c);
        });
        vocabCard.appendChild(tableWrap);
        container.appendChild(vocabCard);

        return;
      }

      // 7-3: (A)ì‹œê°„ (B)ì‚¬ëŒ è¦èµç¾è€¶ç¨£
      if (step.id === "7-3") {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="section-label">${step.title}</div>
          <div class="template-box">
            <div class="zh" id="t73-zh">
              <span class="inline-a">(   )</span><span class="inline-b">(   )</span>è¦èµç¾è€¶ç¨£ã€‚
            </div>
            <div class="pinyin" id="t73-py">(   ) (   ) yÃ o zÃ nmÄ›i yÄ“sÅ«</div>
            <div class="ko" id="t73-ko">
              (   )ì— (   )ëŠ” ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•  ê±°ì˜ˆìš”.
            </div>
          </div>
          <div class="hint">
            A(ë…¸ë‘)ëŠ” <b>ì‹œê°„</b>, B(ì´ˆë¡)ëŠ” <b>ì‚¬ëŒ(ë‚˜, ë„ˆ, ìš°ë¦¬â€¦)</b>ë¥¼ ê³¨ë¼ ë¬¸ì¥ì„ ì™„ì„±í•´ìš”.
          </div>

          <div class="card" style="margin-top:14px; background:#fefce8;">
            <div class="section-label">â‘  A: ì‹œê°„ (ì–¸ì œ?)</div>
            <div class="mini-card-container" id="wrap73-time"></div>
          </div>

          <div class="card" style="margin-top:10px; background:#ecfdf5;">
            <div class="section-label">â‘¡ B: ì‚¬ëŒ (ëˆ„ê°€?)</div>
            <div class="mini-card-container" id="wrap73-subj"></div>
          </div>

          <div class="card" style="margin-top:16px;">
            <div class="section-label">ì™„ì„±ëœ ë¬¸ì¥</div>
            <div class="zh" id="out73-zh" style="display:none;"></div>
            <div class="pinyin" id="out73-py" style="display:none;"></div>
            <div class="ko" id="out73-ko" style="display:none; font-size:24px;"></div>
            <div class="btn-row">
              <button class="secondary" id="btn73-read">ì¤‘êµ­ì–´ ë‹¤ì‹œ ë“£ê¸° â–¶</button>
              <button class="secondary" id="btn73-rec">ë…¹ìŒí•˜ê¸° ğŸ¤</button>
              <button class="ghost" id="btn73-play">ë…¹ìŒ ë“£ê¸° â–¶</button>
            </div>
            <div class="hint" id="status73">A, Bë¥¼ ëª¨ë‘ ê³¨ë¼ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.</div>
          </div>
        `;
        container.appendChild(card);

        const tZh = document.getElementById("t73-zh");
        const tPy = document.getElementById("t73-py");
        const tKo = document.getElementById("t73-ko");
        const oZh = document.getElementById("out73-zh");
        const oPy = document.getElementById("out73-py");
        const oKo = document.getElementById("out73-ko");
        const statusEl = document.getElementById("status73");

        const wrapTime = document.getElementById("wrap73-time");
        const wrapSubj = document.getElementById("wrap73-subj");

        let selectedTime = null;
        let selectedSubj = null;
        let lastSentenceZh = "";

        function update73View() {
          const timeTextZh = selectedTime ? selectedTime.hanzi : "(   )";
          const subjTextZh = selectedSubj ? selectedSubj.zh : "(   )";
          const timeTextKo = selectedTime ? selectedTime.meaning : "(   )";
          const subjTextKo = selectedSubj ? selectedSubj.ko : "(   )";

          tZh.innerHTML = `
            <span class="inline-a">${timeTextZh}</span>
            <span class="inline-b">${subjTextZh}</span>è¦èµç¾è€¶ç¨£ã€‚
          `;
          tPy.textContent = selectedTime && selectedSubj
            ? `${selectedTime.pinyin} ${selectedSubj.pinyin} yÃ o zÃ nmÄ›i yÄ“sÅ«`
            : "(   ) (   ) yÃ o zÃ nmÄ›i yÄ“sÅ«";
          tKo.innerHTML = `
            <span class="inline-a">${timeTextKo}</span>ì—
            <span class="inline-b">${subjTextKo}</span>ëŠ” ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•  ê±°ì˜ˆìš”.
          `;

          if (!selectedTime || !selectedSubj) {
            oZh.style.display = "none";
            oPy.style.display = "none";
            oKo.style.display = "none";
            lastSentenceZh = "";
            return;
          }

          const zhSentence = `${selectedTime.hanzi}${selectedSubj.zh}è¦èµç¾è€¶ç¨£ã€‚`;
          const pySentence = `${selectedTime.pinyin} ${selectedSubj.pinyin} yÃ o zÃ nmÄ›i yÄ“sÅ«`;
          const koSentence = `${selectedTime.meaning}ì— ${selectedSubj.ko}ëŠ” ì˜ˆìˆ˜ë‹˜ì„ ì°¬ì–‘í•  ê±°ì˜ˆìš”.`;

          oZh.style.display = "block";
          oPy.style.display = "block";
          oKo.style.display = "block";
          oZh.textContent = zhSentence;
          oPy.textContent = pySentence;
          oKo.textContent = koSentence;

          lastSentenceZh = zhSentence;
          speakChineseOnce(zhSentence);
        }

        timeWords7.forEach(w => {
          const c = document.createElement("div");
          c.className = "mini-card mini-card-a";
          c.innerHTML = `
            <div class="mini-card-title">${w.meaning}</div>
            <div class="mini-card-zh">${w.hanzi}</div>
            <div class="mini-card-sub">${w.pinyin}</div>
          `;
          c.onclick = () => {
            wrapTime.querySelectorAll(".mini-card").forEach(el => el.style.outline = "none");
            c.style.outline = "3px solid #facc15";
            selectedTime = w;
            update73View();
          };
          wrapTime.appendChild(c);
        });

        subjects7.forEach(s => {
          const c = document.createElement("div");
          c.className = "mini-card mini-card-b";
          c.innerHTML = `
            <div class="mini-card-title">${s.ko}</div>
            <div class="mini-card-zh">${s.zh}</div>
            <div class="mini-card-sub">${s.pinyin}</div>
          `;
          c.onclick = () => {
            wrapSubj.querySelectorAll(".mini-card").forEach(el => el.style.outline = "none");
            c.style.outline = "3px solid #22c55e";
            selectedSubj = s;
            update73View();
          };
          wrapSubj.appendChild(c);
        });

        document.getElementById("btn73-read").onclick = () => {
          if (!lastSentenceZh) {
            statusEl.textContent = "ë¨¼ì € A,Bë¥¼ ê³¨ë¼ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.";
            return;
          }
          speakChineseOnce(lastSentenceZh);
        };
        document.getElementById("btn73-rec").onclick = () => {
          recordSentence("7-3", statusEl);
        };
        document.getElementById("btn73-play").onclick = () => {
          playRecording("7-3");
        };

        return;
      }

      // 7-4: (A)ì‹œê°„ (B)ì‚¬ëŒ è¦æ„Ÿè°¢æˆ‘ç¥
      if (step.id === "7-4") {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="section-label">${step.title}</div>
          <div class="template-box">
            <div class="zh" id="t74-zh">
              <span class="inline-a">(   )</span><span class="inline-b">(   )</span>è¦æ„Ÿè°¢æˆ‘ç¥ã€‚
            </div>
            <div class="pinyin" id="t74-py">(   ) (   ) yÃ o gÇnxiÃ¨ wÇ’ shÃ©n</div>
            <div class="ko" id="t74-ko">
              (   )ì— (   )ëŠ” ë‚˜ì˜ í•˜ë‚˜ë‹˜ê»˜ ê°ì‚¬í•  ê±°ì˜ˆìš”.
            </div>
          </div>
          <div class="hint">
            A(ë…¸ë‘)ëŠ” <b>ì‹œê°„</b>, B(ì´ˆë¡)ëŠ” <b>ì‚¬ëŒ</b>ì´ì—ìš”.<br/>
            â€œì–¸ì œ, ëˆ„ê°€ í•˜ë‚˜ë‹˜ê»˜ ê°ì‚¬í• ê¹Œ?â€ ë¬¸ì¥ìœ¼ë¡œ ë§Œë“¤ì–´ ë³´ì•„ìš”.
          </div>

          <div class="card" style="margin-top:14px; background:#fefce8;">
            <div class="section-label">â‘  A: ì‹œê°„ (ì–¸ì œ?)</div>
            <div class="mini-card-container" id="wrap74-time"></div>
          </div>

          <div class="card" style="margin-top:10px; background:#ecfdf5;">
            <div class="section-label">â‘¡ B: ì‚¬ëŒ (ëˆ„ê°€?)</div>
            <div class="mini-card-container" id="wrap74-subj"></div>
          </div>

          <div class="card" style="margin-top:16px;">
            <div class="section-label">ì™„ì„±ëœ ë¬¸ì¥</div>
            <div class="zh" id="out74-zh" style="display:none;"></div>
            <div class="pinyin" id="out74-py" style="display:none;"></div>
            <div class="ko" id="out74-ko" style="display:none; font-size:24px;"></div>
            <div class="btn-row">
              <button class="secondary" id="btn74-read">ì¤‘êµ­ì–´ ë‹¤ì‹œ ë“£ê¸° â–¶</button>
              <button class="secondary" id="btn74-rec">ë…¹ìŒí•˜ê¸° ğŸ¤</button>
              <button class="ghost" id="btn74-play">ë…¹ìŒ ë“£ê¸° â–¶</button>
            </div>
            <div class="hint" id="status74">A, Bë¥¼ ëª¨ë‘ ê³¨ë¼ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.</div>
          </div>
        `;
        container.appendChild(card);

        const tZh = document.getElementById("t74-zh");
        const tPy = document.getElementById("t74-py");
        const tKo = document.getElementById("t74-ko");
        const oZh = document.getElementById("out74-zh");
        const oPy = document.getElementById("out74-py");
        const oKo = document.getElementById("out74-ko");
        const statusEl = document.getElementById("status74");

        const wrapTime = document.getElementById("wrap74-time");
        const wrapSubj = document.getElementById("wrap74-subj");

        let selectedTime = null;
        let selectedSubj = null;
        let lastSentenceZh = "";

        function update74View() {
          const timeTextZh = selectedTime ? selectedTime.hanzi : "(   )";
          const subjTextZh = selectedSubj ? selectedSubj.zh : "(   )";
          const timeTextKo = selectedTime ? selectedTime.meaning : "(   )";
          const subjTextKo = selectedSubj ? selectedSubj.ko : "(   )";

          tZh.innerHTML = `
            <span class="inline-a">${timeTextZh}</span>
            <span class="inline-b">${subjTextZh}</span>è¦æ„Ÿè°¢æˆ‘ç¥ã€‚
          `;
          tPy.textContent = selectedTime && selectedSubj
            ? `${selectedTime.pinyin} ${selectedSubj.pinyin} yÃ o gÇnxiÃ¨ wÇ’ shÃ©n`
            : "(   ) (   ) yÃ o gÇnxiÃ¨ wÇ’ shÃ©n";
          tKo.innerHTML = `
            <span class="inline-a">${timeTextKo}</span>ì—
            <span class="inline-b">${subjTextKo}</span>ëŠ” ë‚˜ì˜ í•˜ë‚˜ë‹˜ê»˜ ê°ì‚¬í•  ê±°ì˜ˆìš”.
          `;

          if (!selectedTime || !selectedSubj) {
            oZh.style.display = "none";
            oPy.style.display = "none";
            oKo.style.display = "none";
            lastSentenceZh = "";
            return;
          }

          const zhSentence = `${selectedTime.hanzi}${selectedSubj.zh}è¦æ„Ÿè°¢æˆ‘ç¥ã€‚`;
          const pySentence = `${selectedTime.pinyin} ${selectedSubj.pinyin} yÃ o gÇnxiÃ¨ wÇ’ shÃ©n`;
          const koSentence = `${selectedTime.meaning}ì— ${selectedSubj.ko}ëŠ” ë‚˜ì˜ í•˜ë‚˜ë‹˜ê»˜ ê°ì‚¬í•  ê±°ì˜ˆìš”.`;

          oZh.style.display = "block";
          oPy.style.display = "block";
          oKo.style.display = "block";
          oZh.textContent = zhSentence;
          oPy.textContent = pySentence;
          oKo.textContent = koSentence;

          lastSentenceZh = zhSentence;
          speakChineseOnce(zhSentence);
        }

        timeWords7.forEach(w => {
          const c = document.createElement("div");
          c.className = "mini-card mini-card-a";
          c.innerHTML = `
            <div class="mini-card-title">${w.meaning}</div>
            <div class="mini-card-zh">${w.hanzi}</div>
            <div class="mini-card-sub">${w.pinyin}</div>
          `;
          c.onclick = () => {
            wrapTime.querySelectorAll(".mini-card").forEach(el => el.style.outline = "none");
            c.style.outline = "3px solid #facc15";
            selectedTime = w;
            update74View();
          };
          wrapTime.appendChild(c);
        });

        subjects7.forEach(s => {
          const c = document.createElement("div");
          c.className = "mini-card mini-card-b";
          c.innerHTML = `
            <div class="mini-card-title">${s.ko}</div>
            <div class="mini-card-zh">${s.zh}</div>
            <div class="mini-card-sub">${s.pinyin}</div>
          `;
          c.onclick = () => {
            wrapSubj.querySelectorAll(".mini-card").forEach(el => el.style.outline = "none");
            c.style.outline = "3px solid #22c55e";
            selectedSubj = s;
            update74View();
          };
          wrapSubj.appendChild(c);
        });

        document.getElementById("btn74-read").onclick = () => {
          if (!lastSentenceZh) {
            statusEl.textContent = "ë¨¼ì € A,Bë¥¼ ê³¨ë¼ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.";
            return;
          }
          speakChineseOnce(lastSentenceZh);
        };
        document.getElementById("btn74-rec").onclick = () => {
          recordSentence("7-4", statusEl);
        };
        document.getElementById("btn74-play").onclick = () => {
          playRecording("7-4");
        };

        return;
      }

      // 7-5: ì¸ì‚¬ í•™ìŠµ
      if (step.id === "7-5") {
        const intro = document.createElement("div");
        intro.className = "card";
        intro.innerHTML = `
          <div class="section-label">${step.title} Â· í•™ìŠµ</div>
          <div class="ko">${step.description || ""}</div>
        `;
        container.appendChild(intro);

        const baseCard = document.createElement("div");
        baseCard.className = "card table-card";
        baseCard.innerHTML = `<div class="section-label">ê¸°ë³¸ ì¸ì‚¬</div>`;
        const baseWrap = document.createElement("div");
        baseWrap.className = "mini-card-container";
        [
          greetingWords7[0],
          greetingWords7[1],
          greetingWords7[2],
          greetingWords7[3]
        ].forEach(v => {
          const c = document.createElement("div");
          c.className = "mini-card";
          c.innerHTML = `
            <div class="mini-card-title">${v.meaning}</div>
            <div class="mini-card-zh">${v.hanzi}</div>
            <div class="mini-card-sub">${v.pinyin}</div>
          `;
          c.onclick = () => speakChineseOnce(v.hanzi);
          baseWrap.appendChild(c);
        });
        baseCard.appendChild(baseWrap);
        container.appendChild(baseCard);

        const morningCard = document.createElement("div");
        morningCard.className = "card table-card";
        morningCard.innerHTML = `<div class="section-label">ì•„ì¹¨ ì¸ì‚¬</div>`;
        const morningWrap = document.createElement("div");
        morningWrap.className = "mini-card-container";
        const morning = greetingWords7.find(v => v.hanzi === "æ—©ä¸Šå¥½");
        if (morning) {
          const c = document.createElement("div");
          c.className = "mini-card";
          c.innerHTML = `
            <div class="mini-card-title">${morning.meaning}</div>
            <div class="mini-card-zh">${morning.hanzi}</div>
            <div class="mini-card-sub">${morning.pinyin}</div>
          `;
          c.onclick = () => speakChineseOnce(morning.hanzi);
          morningWrap.appendChild(c);
        }
        morningCard.appendChild(morningWrap);
        container.appendChild(morningCard);

        const nightCard = document.createElement("div");
        nightCard.className = "card table-card";
        nightCard.innerHTML = `<div class="section-label">ì €ë…Â·ë°¤ ì¸ì‚¬</div>`;
        const nightWrap = document.createElement("div");
        nightWrap.className = "mini-card-container";
        greetingWords7
          .filter(v => v.hanzi === "æ™šä¸Šå¥½" || v.hanzi === "æ™šå®‰")
          .forEach(v => {
            const c = document.createElement("div");
            c.className = "mini-card";
            c.innerHTML = `
              <div class="mini-card-title">${v.meaning}</div>
              <div class="mini-card-zh">${v.hanzi}</div>
              <div class="mini-card-sub">${v.pinyin}</div>
            `;
            c.onclick = () => speakChineseOnce(v.hanzi);
            nightWrap.appendChild(c);
          });
        nightCard.appendChild(nightWrap);
        container.appendChild(nightCard);

        return;
      }

      // ê¸°ë³¸ fallback
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.title}</div>
        <div class="ko">${step.description || ""}</div>
      `;
      container.appendChild(intro);
    }

    function renderAttr(step, container) {
      clear(container);

      if (step.id !== "7-1") {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="ko">ì´ ë‹¨ê³„ì—ëŠ” â€˜í•˜ë‚˜ë‹˜ ì„±í’ˆ ì°¾ê¸°â€™ í™œë™ì´ ì—†ì–´ìš”.</div>`;
        container.appendChild(card);
        return;
      }

      (step.verses || verses7).forEach(v => {
        const card = document.createElement("div");
        card.className = "card verse-card";
        card.innerHTML = `
          <div class="verse-ref">ğŸ“– ${v.ref}</div>
          <div class="verse-text">${v.textKo}</div>
        `;
        container.appendChild(card);
      });
    }

    function renderFlash(step, container) {
      clear(container);

      const vocab = getFlashVocab(step);

      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.title} Â· í”Œë˜ì‹œ ì¹´ë“œ</div>
        <div class="ko">ì¹´ë“œë¥¼ ëˆŒëŸ¬ ì•ë©´/ë’·ë©´ì„ ë°”ê¾¸ê³ , ë‹¨ì–´ë¥¼ ì†Œë¦¬ ë‚´ì–´ ì½ì–´ ë³´ì•„ìš”.</div>
      `;
      container.appendChild(intro);

      if (!vocab || !vocab.length) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="ko">ì´ ë‹¨ê³„ì—ëŠ” í”Œë˜ì‹œ ì¹´ë“œ ë‹¨ì–´ê°€ ì—†ì–´ìš”.</div>`;
        container.appendChild(card);
        return;
      }

      const flashCard = document.createElement("div");
      flashCard.className = "card";
      flashCard.innerHTML = `
        <div class="flash-wrapper">
          <button class="arrow-btn" id="flash-prev">â—€</button>
          <div class="flashcard" id="flash-card">
            <div class="flash-counter" id="flash-counter"></div>
            <div class="flash-face" id="flash-face"></div>
          </div>
          <button class="arrow-btn" id="flash-next">â–¶</button>
        </div>
        <div class="idx-text" id="flash-idx"></div>
        <div class="btn-row">
          <button id="flash-speak">ë‹¤ì‹œ ë“£ê¸° â–¶</button>
          <button class="secondary" id="flash-rec">ë…¹ìŒí•˜ê¸° ğŸ¤</button>
          <button class="ghost" id="flash-play">ë…¹ìŒ ë“£ê¸° â–¶</button>
        </div>
        <div class="hint" id="flash-status">ì¹´ë“œë¥¼ ëˆŒëŸ¬ ì•/ë’·ë©´ì„ ë°”ê¾¸ì–´ ë³´ì„¸ìš”.</div>
      `;
      container.appendChild(flashCard);

      let fIdx = 0;
      let fFront = true;

      function drawFlash() {
        const v = vocab[fIdx];
        const face = document.getElementById("flash-face");
        const counterEl = document.getElementById("flash-counter");
        const cardEl = document.getElementById("flash-card");
        const idxEl = document.getElementById("flash-idx");

        counterEl.textContent = `${fIdx + 1} / ${vocab.length}`;
        idxEl.textContent = `${fIdx + 1} / ${vocab.length}`;

        if (fFront) {
          cardEl.classList.remove("back");
          face.innerHTML = `<div class="flash-front">${v.hanzi}</div>`;
          speakChineseOnce(v.hanzi);
        } else {
          cardEl.classList.add("back");
          face.innerHTML = `
            <div class="flash-back-main">${v.meaning}</div>
            <div class="flash-back-sub">${v.hanzi} Â· ${v.pinyin}</div>
          `;
        }
      }

      document.getElementById("flash-card").onclick = () => {
        fFront = !fFront;
        drawFlash();
      };
      document.getElementById("flash-prev").onclick = () => {
        fIdx = (fIdx - 1 + vocab.length) % vocab.length;
        fFront = true;
        drawFlash();
      };
      document.getElementById("flash-next").onclick = () => {
        fIdx = (fIdx + 1) % vocab.length;
        fFront = true;
        drawFlash();
      };
      document.getElementById("flash-speak").onclick = () => {
        const v = vocab[fIdx];
        speakChineseOnce(v.hanzi);
      };
      document.getElementById("flash-rec").onclick = () => {
        const v = vocab[fIdx];
        recordSentence("flash-7-" + v.hanzi, document.getElementById("flash-status"));
      };
      document.getElementById("flash-play").onclick = () => {
        const v = vocab[fIdx];
        playRecording("flash-7-" + v.hanzi);
      };

      drawFlash();
    }

    function renderQuiz(step, container) {
      clear(container);

      if (step.id !== "7-5") {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="section-label">${step.title} Â· í€´ì¦ˆ</div>
          <div class="ko">ì´ ë‹¨ê³„ì—ëŠ” ë³„ë„ì˜ í€´ì¦ˆê°€ ì—†ì–´ìš”.</div>
        `;
        container.appendChild(card);
        return;
      }

      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">7-5 ì°¬ì–‘ & ì¸ì‚¬ ë³µìŠµ í€´ì¦ˆ</div>
        <div class="ko">
          ìš°ë¦¬ë§ ë¬¸ì¥ì„ ë³´ê³  ì¤‘êµ­ì–´ë¡œ ë§í•´ ë³´ê³ ,<br/>
          ë…¹ìŒí•´ ë³¸ ë’¤ â€˜ì •ë‹µ ë“£ê¸°â€™ë¡œ í™•ì¸í•´ìš”.
        </div>
      `;
      container.appendChild(intro);

      (step.quiz || quizItems7).forEach((q, idx) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="section-label">í€´ì¦ˆ ${idx + 1}</div>
          <div class="ko">Q. ${q.ko}</div>
          <div class="btn-row">
            <button class="secondary" id="quiz-rec-${q.id}">ì¤‘êµ­ì–´ë¡œ ë§í•˜ê¸° ğŸ¤</button>
            <button class="ghost" id="quiz-play-${q.id}">ë…¹ìŒ ë“£ê¸° â–¶</button>
            <button id="quiz-ans-${q.id}">ì •ë‹µ ë“£ê¸° â–¶</button>
          </div>
          <div class="zh" id="quiz-zh-${q.id}" style="display:none; margin-top:10px;"></div>
          <div class="pinyin" id="quiz-py-${q.id}" style="display:none;"></div>
          <div class="hint" id="quiz-status-${q.id}"></div>
        `;
        container.appendChild(card);

        document.getElementById(`quiz-rec-${q.id}`).onclick = () => {
          recordSentence("quiz-" + q.id, document.getElementById(`quiz-status-${q.id}`));
        };
        document.getElementById(`quiz-play-${q.id}`).onclick = () => {
          playRecording("quiz-" + q.id);
        };
        document.getElementById(`quiz-ans-${q.id}`).onclick = () => {
          speakChineseOnce(q.zh);
          const zhEl = document.getElementById(`quiz-zh-${q.id}`);
          const pyEl = document.getElementById(`quiz-py-${q.id}`);
          zhEl.style.display = "block";
          pyEl.style.display = "block";
          zhEl.textContent = q.zh;
          pyEl.textContent = q.py;
        };
      });

      const matchCard = document.createElement("div");
      matchCard.className = "card";
      matchCard.innerHTML = `
        <div class="section-label">7-5 ë‹¨ì–´ Â· ëœ» ë§¤ì¹­ ê²Œì„</div>
        <div class="ko">
          ì™¼ìª½ ì¤‘êµ­ì–´ ë‹¨ì–´ì™€ ì˜¤ë¥¸ìª½ ìš°ë¦¬ë§ ëœ»ì„ ìˆœì„œëŒ€ë¡œ ëˆŒëŸ¬ ì§ì„ ë§ì¶° ë³´ì„¸ìš”.<br/>
          ì •ë‹µì´ë©´ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë³€í•˜ê³ , ë°œìŒë„ ë“¤ë ¤ì¤„ê²Œìš”.
        </div>
        <div class="match-layout">
          <div class="match-col" id="match-left-7"></div>
          <div class="match-col" id="match-right-7"></div>
        </div>
        <div class="hint" id="match-status-7" style="margin-top:12px;"></div>
      `;
      container.appendChild(matchCard);

      const leftEl = document.getElementById("match-left-7");
      const rightEl = document.getElementById("match-right-7");
      const statusEl = document.getElementById("match-status-7");

      const leftItems = shuffleArray([
        { key: "èµç¾",   label: "èµç¾" },
        { key: "æ—©æ™¨",   label: "æ—©æ™¨" },
        { key: "ä¸­åˆ",   label: "ä¸­åˆ" },
        { key: "æ™šä¸Š",   label: "æ™šä¸Š" },
        { key: "ä¸»",     label: "ä¸»" },
        { key: "è€¶ç¨£",   label: "è€¶ç¨£" },
        { key: "æ—©ä¸Šå¥½", label: "æ—©ä¸Šå¥½" },
        { key: "æ™šä¸Šå¥½", label: "æ™šä¸Šå¥½" },
        { key: "æ™šå®‰",   label: "æ™šå®‰" },
        { key: "ä½ å¥½",   label: "ä½ å¥½" },
        { key: "å†è§",   label: "å†è§" }
      ]);

      const rightItems = shuffleArray([
        { key: "èµç¾",   label: "ì°¬ì–‘í•˜ë‹¤" },
        { key: "æ—©æ™¨",   label: "ì•„ì¹¨(ì´ë¥¸ ì•„ì¹¨)" },
        { key: "ä¸­åˆ",   label: "ì ì‹¬, ì •ì˜¤" },
        { key: "æ™šä¸Š",   label: "ì €ë…, ë°¤" },
        { key: "ä¸»",     label: "ì£¼ë‹˜" },
        { key: "è€¶ç¨£",   label: "ì˜ˆìˆ˜ë‹˜" },
        { key: "æ—©ä¸Šå¥½", label: "ì¢‹ì€ ì•„ì¹¨" },
        { key: "æ™šä¸Šå¥½", label: "ì¢‹ì€ ì €ë…" },
        { key: "æ™šå®‰",   label: "ì˜ ììš”" },
        { key: "ä½ å¥½",   label: "ì•ˆë…•" },
        { key: "å†è§",   label: "ë˜ ë´ìš”" }
      ]);

      let selectedLeftKey = null;
      let solved = 0;
      const total = leftItems.length;

      leftItems.forEach(item => {
        const btn = document.createElement("button");
        btn.className = "match-btn";
        btn.textContent = item.label;
        btn.dataset.key = item.key;
        btn.onclick = () => {
          if (btn.classList.contains("correct")) return;
          leftEl.querySelectorAll(".match-btn").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedLeftKey = item.key;
          statusEl.textContent = "ì´ì œ ì˜¤ë¥¸ìª½ì—ì„œ ëœ»ì„ ê³¨ë¼ ë³´ì„¸ìš”.";
        };
        leftEl.appendChild(btn);
      });

      rightItems.forEach(item => {
        const btn = document.createElement("button");
        btn.className = "match-btn";
        btn.textContent = item.label;
        btn.dataset.key = item.key;
        btn.onclick = () => {
          if (btn.classList.contains("correct")) return;

          const leftSelectedBtn = leftEl.querySelector(".match-btn.selected");
          if (!leftSelectedBtn) {
            statusEl.textContent = "ë¨¼ì € ì™¼ìª½ ë‹¨ì–´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.";
            return;
          }

          const leftKey = leftSelectedBtn.dataset.key;
          const rightKey = item.key;

          if (leftKey === rightKey) {
            leftSelectedBtn.classList.remove("selected");
            leftSelectedBtn.classList.add("correct");
            btn.classList.add("correct");
            solved++;
            statusEl.textContent = "ì •ë‹µì´ì—ìš”! ğŸ‘";
            speakChineseOnce(leftKey);
            selectedLeftKey = null;
            if (solved === total) {
              statusEl.textContent = "ëª¨ë“  ë‹¨ì–´ë¥¼ ë‹¤ ë§ì·„ì–´ìš”! ë„ˆë¬´ ì˜í–ˆì–´ìš” ğŸ‰";
            }
          } else {
            btn.classList.add("wrong");
            statusEl.textContent = "ì¡°ê¸ˆ ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ í•œ ë²ˆ ë„ì „í•´ ë³´ì!";
            setTimeout(() => {
              btn.classList.remove("wrong");
              if (leftSelectedBtn) leftSelectedBtn.classList.remove("selected");
              selectedLeftKey = null;
            }, 600);
          }
        };
        rightEl.appendChild(btn);
      });
    }

    function renderVerse(step, container) {
      clear(container);

      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.title} Â· ë§ì”€ ì¹´ë“œ</div>
        <div class="ko">${step.description || ""}</div>
      `;
      container.appendChild(intro);

      (step.verses || verses7).forEach(v => {
        const card = document.createElement("div");
        card.className = "card verse-card";
        card.innerHTML = `
          <div class="verse-ref">ğŸ“– ${v.ref}</div>
          <div class="verse-text">${v.textKo}</div>
        `;
        container.appendChild(card);
      });
    }

    /* ===== 3. íƒ­ ë Œë”ë§ ===== */

    function renderStepTabs() {
      clear(stepTabsEl);
      lesson7.steps.forEach(step => {
        const b = document.createElement("button");
        b.className = "step-tab";
        if (step.id === currentStepId) b.classList.add("active");
        b.textContent = step.label;
        b.onclick = () => {
          currentStepId = step.id;
          const allowed = getStepModes(step);
          if (!allowed.includes(currentModeId)) {
            currentModeId = allowed[0];
          }
          renderStepTabs();
          renderModeTabs();
          renderContent();
        };
        stepTabsEl.appendChild(b);
      });
    }

    function renderModeTabs() {
      clear(modeTabsEl);
      const step = getCurrentStep();
      if (!step) return;

      const allowedIds = getStepModes(step);
      allowedIds.forEach(id => {
        const m = modesBase7.find(mm => mm.id === id);
        if (!m) return;
        const b = document.createElement("button");
        b.className = "mode-tab";
        if (m.id === currentModeId) b.classList.add("active");
        b.textContent = m.label;
        b.onclick = () => {
          currentModeId = m.id;
          renderModeTabs();
          renderContent();
        };
        modeTabsEl.appendChild(b);
      });
    }

    function renderContent() {
      clear(contentEl);
      const step = getCurrentStep();
      if (!step) return;

      const allowed = getStepModes(step);
      if (!allowed.includes(currentModeId)) {
        currentModeId = allowed[0];
        renderModeTabs();
      }

      if (currentModeId === "study") renderStudy(step, contentEl);
      else if (currentModeId === "attr") renderAttr(step, contentEl);
      else if (currentModeId === "flash") renderFlash(step, contentEl);
      else if (currentModeId === "quiz") renderQuiz(step, contentEl);
      else if (currentModeId === "verse") renderVerse(step, contentEl);
    }

    renderStepTabs();
    renderModeTabs();
    renderContent();
  </script>
</body>
</html>
