<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>4ê³¼. ì²œêµ­ì€ ì¦ê±°ìš´ ê³³ Â· å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      background: #f7f9fc;
      font-size: 24px;
      color: #111;
    }
    h1 {
      font-size: 40px;
      margin-bottom: 16px;
      color: #000;
    }

    /* ìƒë‹¨ ë‹¨ê³„ íƒ­: 1,2,3... */
    .step-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }
    .step-tab {
      min-width: 52px;
      height: 48px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #fed7aa;
      font-size: 20px;
      color: #7c2d12;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 14px;
      white-space: nowrap;
    }
    .step-tab.active {
      background: #f97316;
      color: #fff;
      box-shadow: 0 0 0 2px #ffedd5 inset;
    }

    /* íŒŒë€ìƒ‰ ì†Œíƒ­ (ëª¨ë“œ íƒ­) */
    .mode-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }
    .mode-tab {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #e0e7ff;
      font-size: 20px;
      color: #111827;
    }
    .mode-tab.active {
      background: #2563eb;
      color: #fff;
    }

    .card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    .section-label {
      font-size: 20px;
      color: #374151;
      margin-bottom: 8px;
    }
    h2 {
      font-size: 30px;
      margin-bottom: 10px;
      color: #000;
    }

    .zh {
      font-size: 44px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #b91c1c;
    }
    .pinyin {
      font-size: 26px;
      color: #444;
      margin-bottom: 4px;
    }
    .ko {
      font-size: 26px;
      color: #222;
      margin-bottom: 10px;
      white-space: pre-line;
    }
    .hint {
      font-size: 20px;
      color: #555;
      margin-top: 8px;
    }

    button {
      padding: 10px 20px;
      font-size: 22px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      margin-right: 8px;
      margin-top: 6px;
      background: #2563eb;
      color: white;
    }
    button.secondary { background: #10b981; }
    button.ghost { background: #e5e7eb; color: #1f2937; }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    /* ë§ì”€ ì¹´ë“œ */
    .verse-card {
      background: linear-gradient(135deg, #fef3c7, #e0f2fe);
      border-left: 6px solid #f97316;
      margin-bottom: 12px;
    }
    .verse-ref {
      font-size: 26px;
      color: #555;
      margin-bottom: 4px;
    }
    .verse-text {
      font-size: 26px;
      white-space: pre-line;
      color: #111;
    }

    /* ë™ì˜ìƒ */
    .video-wrapper {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      background: #000;
      border-radius: 20px;
      overflow: hidden;
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .video-wrapper iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    /* í”Œë˜ì‹œì¹´ë“œ */
    .flash-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 12px;
    }
    .flashcard {
      min-height: 220px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #ffedd5, #fed7aa);
      border-radius: 20px;
      cursor: pointer;
      text-align: center;
      padding: 24px;
      position: relative;
      transition: background 0.25s ease;
    }
    .flashcard.back {
      background: linear-gradient(135deg, #ecfdf5, #a5f3fc);
    }
    .flash-face {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .flash-counter {
      position: absolute;
      top: 10px;
      left: 14px;
      font-size: 18px;
      color: #374151;
      background: rgba(255,255,255,0.8);
      padding: 2px 10px;
      border-radius: 999px;
    }
    .flash-front {
      font-size: 72px;
      font-weight: bold;
      color: #b91c1c;
    }
    .flash-back-main {
      font-size: 38px;
      font-weight: bold;
      color: #000;
      margin-bottom: 6px;
    }
    .flash-back-sub {
      font-size: 26px;
      color: #333;
    }
    .idx-text {
      font-size: 20px;
      margin-top: 6px;
      color: #444;
      text-align: center;
    }
    .arrow-btn {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      font-size: 26px;
      color: #374151;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* ì¸ë¼ì¸ í•˜ì´ë¼ì´íŠ¸ */
    .inline-highlight {
      background: #fed7aa;
      padding: 0 4px;
      border-radius: 6px;
      box-shadow: 0 0 0 2px #fdba74 inset;
    }

    /* ë¬¸ì¥ ë§Œë“¤ê¸° ë¯¸ë‹ˆ ì¹´ë“œ */
    .mini-card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }
    .mini-card {
      background: #f1f5f9;
      border-radius: 14px;
      padding: 10px 14px;
      min-width: 150px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(15,23,42,0.12);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    .mini-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(15,23,42,0.16);
      background: #e0f2fe;
    }
    .mini-card-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #111827;
    }
    .mini-card-zh {
      font-size: 24px;
      color: #b91c1c;
      margin-bottom: 2px;
    }
    .mini-card-sub {
      font-size: 18px;
      color: #4b5563;
    }

    /* ë§¤ì¹­ ê²Œì„ */
    .match-layout {
      display: flex;
      gap: 16px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .match-col {
      flex: 1;
      min-width: 180px;
    }
    .match-btn {
      display: block;
      width: 100%;
      margin-bottom: 8px;
      padding: 8px 14px;
      font-size: 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      text-align: left;
      background: #e5e7eb;
      color: #111827;
      transition: background 0.12s ease, transform 0.12s ease;
    }
    .match-btn:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }
    .match-btn.selected {
      background: #fee2e2;
    }
    .match-btn.correct {
      background: #bbf7d0;
      cursor: default;
    }
    .match-btn.wrong {
      background: #fecaca;
    }
  </style>
</head>
<body>
  <h1>4ê³¼. ì²œêµ­ì€ ì¦ê±°ìš´ ê³³ Â· å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„</h1>

  <div id="step-tabs" class="step-tabs"></div>
  <div id="mode-tabs" class="mode-tabs"></div>
  <div id="content"></div>

  <script>
    /* ===== 1. ì¤‘êµ­ì–´ ìŒì„± ì„¤ì • ===== */
    let zhVoices = [];
    let selectedZhVoice = null;

    function loadZhVoices() {
      if (!("speechSynthesis" in window)) return;
      const voices = window.speechSynthesis.getVoices();
      zhVoices = voices.filter(v =>
        (v.lang && v.lang.toLowerCase().startsWith("zh")) ||
        (v.lang && v.lang.toLowerCase().includes("hans")) ||
        (v.name && v.name.toLowerCase().includes("chinese"))
      );
      selectedZhVoice =
        zhVoices.find(v => v.lang && v.lang.toLowerCase() === "zh-cn") ||
        zhVoices[0] || null;
    }
    if ("speechSynthesis" in window) {
      loadZhVoices();
      window.speechSynthesis.onvoiceschanged = loadZhVoices;
    }

    function ensureChineseVoice() {
      if (!("speechSynthesis" in window)) {
        alert("ë¸Œë¼ìš°ì €ê°€ ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.");
        return false;
      }
      if (!selectedZhVoice) {
        alert(
          "ê¸°ê¸°ì—ì„œ ì¤‘êµ­ì–´ ìŒì„±ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”.\n" +
          "íœ´ëŒ€í°/ì»´í“¨í„° ì„¤ì •ì—ì„œ 'ì¤‘êµ­ì–´(Chinese, China / æ™®é€šè¯)' ìŒì„±ì„ ì„¤ì¹˜í•˜ê³ ,\n" +
          "í…ìŠ¤íŠ¸ ì½ê¸°(TTS) ê¸°ë³¸ ìŒì„±ìœ¼ë¡œ ì„¤ì •í•´ ì£¼ì„¸ìš”."
        );
        return false;
      }
      return true;
    }

    function speakChineseOnce(text) {
      if (!ensureChineseVoice()) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang  = "zh-CN";
      u.voice = selectedZhVoice;
      u.rate  = 0.9;
      u.pitch = 1.0;
      window.speechSynthesis.speak(u);
    }

    function speakChineseFive(text) {
      if (!ensureChineseVoice()) return;
      window.speechSynthesis.cancel();
      let count = 0;
      function play() {
        const u = new SpeechSynthesisUtterance(text);
        u.lang  = "zh-CN";
        u.voice = selectedZhVoice;
        u.rate  = 0.9;
        u.pitch = 1.0;
        u.onend = () => {
          count++;
          if (count < 5) setTimeout(play, 300);
        };
        window.speechSynthesis.speak(u);
      }
      play();
    }

    function clear(el) {
      while (el.firstChild) el.removeChild(el.firstChild);
    }
    function shuffleArray(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    /* ===== 2. ë°ì´í„° ===== */
    const verses4 = [
      {
        ref: "ë§ˆíƒœë³µìŒ 13:44",
        text: "ì²œêµ­ì€ ë§ˆì¹˜ ë°­ì— ê°ì¶”ì¸ ë³´í™”ì™€ ê°™ìœ¼ë‹ˆ ì‚¬ëŒì´ ì´ë¥¼ ë°œê²¬í•œ í›„ ìˆ¨ê²¨ ë‘ê³  ê¸°ë»í•˜ë©° ëŒì•„ê°€ì„œ ìê¸°ì˜ ì†Œìœ ë¥¼ ë‹¤ íŒ”ì•„ ê·¸ ë°­ì„ ì‚¬ëŠë‹ˆë¼"
      },
      {
        ref: "ë§ˆíƒœë³µìŒ 13:45-46",
        text: "ë˜ ì²œêµ­ì€ ë§ˆì¹˜ ì¢‹ì€ ì§„ì£¼ë¥¼ êµ¬í•˜ëŠ” ì¥ì‚¬ì™€ ê°™ìœ¼ë‹ˆ ê·¹íˆ ê°’ì§„ ì§„ì£¼ í•˜ë‚˜ë¥¼ ë°œê²¬í•˜ë§¤ ê°€ì„œ ìê¸°ì˜ ì†Œìœ ë¥¼ ë‹¤ íŒ”ì•„ ê·¸ ì§„ì£¼ë¥¼ ì‚¬ëŠë‹ˆë¼"
      },
      {
        ref: "ë¹Œë¦½ë³´ì„œ 3:20",
        text: "ê·¸ëŸ¬ë‚˜ ìš°ë¦¬ì˜ ì‹œë¯¼ê¶Œì€ í•˜ëŠ˜ì— ìˆëŠ”ì§€ë¼ ê±°ê¸°ë¡œë¶€í„° êµ¬ì›í•˜ëŠ” ì´ ê³§ ì£¼ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„ë¥¼ ê¸°ë‹¤ë¦¬ë…¸ë‹ˆ"
      },
      {
        ref: "ì‹œí¸ 122:1",
        text: "ì‚¬ëŒë“¤ì´ ë‚´ê²Œ ë§í•˜ê¸°ë¥¼ â€˜ì—¬í˜¸ì™€ì˜ ì§‘ì— ì˜¬ë¼ê°€ìâ€™ í•  ë•Œì— ë‚´ê°€ ê¸°ë»í•˜ì˜€ë„ë‹¤"
      },
      {
        ref: "ì—¬í˜¸ìˆ˜ì•„ 24:15 (í›„ë°˜ë¶€)",
        text: "ì˜¤ì§ ë‚˜ì™€ ë‚´ ì§‘ì€ ì—¬í˜¸ì™€ë¥¼ ì„¬ê¸°ê² ë…¸ë¼"
      },
      {
        ref: "ì ì–¸ 3:13",
        text: "ì§€í˜œë¥¼ ì–»ì€ ìì™€ ëª…ì² ì„ ì–»ì€ ìëŠ” ë³µì´ ìˆë‚˜ë‹ˆ"
      }
    ];

    const songVideoId4 = "OXUiNrHGoKI";

    const vocab4 = [
      { hanzi: "å¤©å ‚", pinyin: "tiÄntÃ¡ng", meaning: "ì²œêµ­" },
      { hanzi: "æ˜¯", pinyin: "shÃ¬", meaning: "~ì´ë‹¤" },
      { hanzi: "ä¸ª", pinyin: "gÃ¨", meaning: "(ì–‘ì‚¬: ê°œ)" },
      { hanzi: "å¿«ä¹", pinyin: "kuÃ ilÃ¨", meaning: "ì¦ê±°ìš´, ê¸°ìœ" },
      { hanzi: "å¤„", pinyin: "chÃ¹", meaning: "ì¥ì†Œ, ê³³" },
      { hanzi: "å“ˆåˆ©è·¯äºš", pinyin: "hÄlÃ¬lÃ¹yÃ ", meaning: "í• ë ë£¨ì•¼" }
    ];

    // 4-3 ì¥ì†Œ
    const words43 = [
      { kr: "ì²œêµ­", zh: "å¤©å ‚", pinyin: "tiÄntÃ¡ng", meaning: "ì²œêµ­" },
      { kr: "êµíšŒ", zh: "æ•™ä¼š", pinyin: "jiÃ ohuÃ¬", meaning: "êµíšŒ" },
      { kr: "ì§‘", zh: "å®¶", pinyin: "jiÄ", meaning: "ì§‘" },
      { kr: "í•™êµ", zh: "å­¦æ ¡", pinyin: "xuÃ©xiÃ o", meaning: "í•™êµ" },
      { kr: "ë„ì„œê´€", zh: "å›¾ä¹¦é¦†", pinyin: "tÃºshÅ«guÇn", meaning: "ë„ì„œê´€" },
      { kr: "ë†€ì´í„°", zh: "æ¸¸ä¹åœº", pinyin: "yÃ³ulÃ¨chÇng", meaning: "ë†€ì´í„°" },
      { kr: "ê³µì›", zh: "å…¬å›­", pinyin: "gÅngyuÃ¡n", meaning: "ê³µì›" },
      { kr: "ë³‘ì›", zh: "åŒ»é™¢", pinyin: "yÄ«yuÃ n", meaning: "ë³‘ì›" },
      { kr: "ì‹œì¥", zh: "å¸‚åœº", pinyin: "shÃ¬chÇng", meaning: "ì‹œì¥" },
      { kr: "ë§ˆíŠ¸", zh: "è¶…å¸‚", pinyin: "chÄoshÃ¬", meaning: "ë§ˆíŠ¸/ìŠˆí¼" }
    ];

    // 4-4: ë‚˜, ë„ˆ, ê·¸, ê·¸ë…€, ìš°ë¦¬, ë„ˆí¬, ê·¸ë“¤ + ì—„ë§ˆ, ì•„ë¹ , í˜•, ëˆ„ë‚˜, ë‚¨ë™ìƒ, ì—¬ë™ìƒ
    const words44 = [
      { kr: "ë‚˜", zh: "æˆ‘", pinyin: "wÇ’", meaning: "ë‚˜" },
      { kr: "ë„ˆ", zh: "ä½ ", pinyin: "nÇ", meaning: "ë„ˆ" },
      { kr: "ê·¸", zh: "ä»–", pinyin: "tÄ", meaning: "ê·¸" },
      { kr: "ê·¸ë…€", zh: "å¥¹", pinyin: "tÄ", meaning: "ê·¸ë…€" },
      { kr: "ìš°ë¦¬", zh: "æˆ‘ä»¬", pinyin: "wÇ’men", meaning: "ìš°ë¦¬" },
      { kr: "ë„ˆí¬", zh: "ä½ ä»¬", pinyin: "nÇmen", meaning: "ë„ˆí¬" },
      { kr: "ê·¸ë“¤", zh: "ä»–ä»¬", pinyin: "tÄmen", meaning: "ê·¸ë“¤" },
      { kr: "ì—„ë§ˆ", zh: "å¦ˆå¦ˆ", pinyin: "mÄma", meaning: "ì—„ë§ˆ" },
      { kr: "ì•„ë¹ ", zh: "çˆ¸çˆ¸", pinyin: "bÃ ba", meaning: "ì•„ë¹ " },
      { kr: "í˜•", zh: "å“¥å“¥", pinyin: "gÄ“ge", meaning: "í˜•" },
      { kr: "ëˆ„ë‚˜/ì–¸ë‹ˆ", zh: "å§å§", pinyin: "jiÄ›jie", meaning: "ëˆ„ë‚˜/ì–¸ë‹ˆ" },
      { kr: "ë‚¨ë™ìƒ", zh: "å¼Ÿå¼Ÿ", pinyin: "dÃ¬di", meaning: "ë‚¨ë™ìƒ" },
      { kr: "ì—¬ë™ìƒ", zh: "å¦¹å¦¹", pinyin: "mÃ¨imei", meaning: "ì—¬ë™ìƒ" }
    ];

    // 4-6: ë‚˜ëŠ” (    )ì…ë‹ˆë‹¤.
    const words45 = [
      { kr: "ê¸°ë…êµì¸", zh: "åŸºç£å¾’", pinyin: "jÄ«dÅ«tÃº", meaning: "ê¸°ë…êµì¸" },
      { kr: "ì•„ë“¤", zh: "å„¿å­", pinyin: "Ã©rzi", meaning: "ì•„ë“¤" },
      { kr: "ë”¸", zh: "å¥³å„¿", pinyin: "nÇš'Ã©r", meaning: "ë”¸" },
      { kr: "í•˜ë‚˜ë‹˜ì˜ ì•„ë“¤", zh: "ç¥çš„å„¿å­", pinyin: "shÃ©n de Ã©rzi", meaning: "í•˜ë‚˜ë‹˜ì˜ ì•„ë“¤" },
      { kr: "í•˜ë‚˜ë‹˜ì˜ ë”¸", zh: "ç¥çš„å¥³å„¿", pinyin: "shÃ©n de nÇš'Ã©r", meaning: "í•˜ë‚˜ë‹˜ì˜ ë”¸" },
      { kr: "í•™ìƒ", zh: "å­¦ç”Ÿ", pinyin: "xuÃ©sheng", meaning: "í•™ìƒ" },
      { kr: "ì„ ìƒë‹˜", zh: "è€å¸ˆ", pinyin: "lÇoshÄ«", meaning: "ì„ ìƒë‹˜" },
      { kr: "ì•„ë¹ ", zh: "çˆ¸çˆ¸", pinyin: "bÃ ba", meaning: "ì•„ë¹ " },
      { kr: "ì—„ë§ˆ", zh: "å¦ˆå¦ˆ", pinyin: "mÄma", meaning: "ì—„ë§ˆ" },
      { kr: "í˜•", zh: "å“¥å“¥", pinyin: "gÄ“ge", meaning: "í˜•" },
      { kr: "ëˆ„ë‚˜", zh: "å§å§", pinyin: "jiÄ›jie", meaning: "ëˆ„ë‚˜/ì–¸ë‹ˆ" },
      { kr: "ë‚¨ë™ìƒ", zh: "å¼Ÿå¼Ÿ", pinyin: "dÃ¬di", meaning: "ë‚¨ë™ìƒ" },
      { kr: "ì—¬ë™ìƒ", zh: "å¦¹å¦¹", pinyin: "mÃ¨imei", meaning: "ì—¬ë™ìƒ" }
    ];

    // 4-5: (    ) ê¸°ë…êµì¸ì´ë‹¤. (ì£¼ì–´ í˜•íƒœ)
    const words45Subject = [
      { kr: "ë‚˜", subjKo: "ë‚˜ëŠ”", zh: "æˆ‘", pinyin: "wÇ’", meaning: "ë‚˜" },
      { kr: "ë„ˆ", subjKo: "ë„ˆëŠ”", zh: "ä½ ", pinyin: "nÇ", meaning: "ë„ˆ" },
      { kr: "ê·¸", subjKo: "ê·¸ëŠ”", zh: "ä»–", pinyin: "tÄ", meaning: "ê·¸" },
      { kr: "ê·¸ë…€", subjKo: "ê·¸ë…€ëŠ”", zh: "å¥¹", pinyin: "tÄ", meaning: "ê·¸ë…€" },
      { kr: "ìš°ë¦¬", subjKo: "ìš°ë¦¬ëŠ”", zh: "æˆ‘ä»¬", pinyin: "wÇ’men", meaning: "ìš°ë¦¬" },
      { kr: "ë„ˆí¬", subjKo: "ë„ˆí¬ëŠ”", zh: "ä½ ä»¬", pinyin: "nÇmen", meaning: "ë„ˆí¬" },
      { kr: "ê·¸ë“¤", subjKo: "ê·¸ë“¤ì€", zh: "ä»–ä»¬", pinyin: "tÄmen", meaning: "ê·¸ë“¤" },
      { kr: "ì—„ë§ˆ", subjKo: "ì—„ë§ˆëŠ”", zh: "å¦ˆå¦ˆ", pinyin: "mÄma", meaning: "ì—„ë§ˆ" },
      { kr: "ì•„ë¹ ", subjKo: "ì•„ë¹ ëŠ”", zh: "çˆ¸çˆ¸", pinyin: "bÃ ba", meaning: "ì•„ë¹ " },
      { kr: "í˜•", subjKo: "í˜•ì€", zh: "å“¥å“¥", pinyin: "gÄ“ge", meaning: "í˜•" },
      { kr: "ëˆ„ë‚˜", subjKo: "ëˆ„ë‚˜ëŠ”", zh: "å§å§", pinyin: "jiÄ›jie", meaning: "ëˆ„ë‚˜/ì–¸ë‹ˆ" },
      { kr: "ë‚¨ë™ìƒ", subjKo: "ë‚¨ë™ìƒì€", zh: "å¼Ÿå¼Ÿ", pinyin: "dÃ¬di", meaning: "ë‚¨ë™ìƒ" },
      { kr: "ì—¬ë™ìƒ", subjKo: "ì—¬ë™ìƒì€", zh: "å¦¹å¦¹", pinyin: "mÃ¨imei", meaning: "ì—¬ë™ìƒ" }
    ];

    const lesson4 = {
      steps: [
        {
          id: "4-1",
          label: "4-1 ë§ì”€ê³¼ ì²œêµ­ ê·¸ë¦¼",
          description: "ì²œêµ­ì´ ì–´ë–¤ ê³³ì¸ì§€ ë§ì”€ìœ¼ë¡œ ë¨¼ì € ë§ˆìŒì— ê·¸ë ¤ ë´ìš”.",
          sentences: [],
          verses: [verses4[0], verses4[1], verses4[2]]
        },
        {
          id: "4-2",
          label: "4-2 ì°¬ì–‘ - å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„",
          description: "ì°¬ì–‘ì„ ë“¤ìœ¼ë©° â€œå¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„â€ë¥¼ ë”°ë¼ ë¶ˆëŸ¬ ë³´ì•„ìš”.",
          sentences: [
            {
              id: "4-2-1",
              zh: "å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„ã€‚",
              pinyin: "tiÄntÃ¡ng shÃ¬ gÃ¨ kuÃ ilÃ¨ chÃ¹",
              ko: "ì²œêµ­ì€ ì¦ê±°ìš´ ê³³ì´ì—ìš”."
            },
            {
              id: "4-2-2",
              zh: "å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„ï¼Œå“ˆåˆ©è·¯äºšã€‚",
              pinyin: "tiÄntÃ¡ng shÃ¬ gÃ¨ kuÃ ilÃ¨ chÃ¹, hÄlÃ¬lÃ¹yÃ ",
              ko: "ì²œêµ­ì€ ì¦ê±°ìš´ ê³³, í• ë ë£¨ì•¼."
            }
          ],
          verses: [verses4[0], verses4[3]],
          songVideoId: songVideoId4
        },
        {
          id: "4-3",
          label: "4-3 (   )ì€ ì¦ê±°ìš´ ê³³ì´ì—ìš”",
          description: "ì¥ì†Œ ë‹¨ì–´ë¥¼ ë„£ì–´ì„œ â€˜ì¦ê±°ìš´ ê³³â€™ ë¬¸ì¥ì„ ë§Œë“¤ì–´ ë³´ì•„ìš”.",
          sentences: [
            {
              id: "4-3-1",
              zh: "å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„ã€‚",
              pinyin: "tiÄntÃ¡ng shÃ¬ gÃ¨ kuÃ ilÃ¨ chÃ¹",
              ko: "ì²œêµ­ì€ ì¦ê±°ìš´ ê³³ì´ì—ìš”."
            },
            {
              id: "4-3-2",
              zh: "æ•™ä¼šæ˜¯ä¸ªå¿«ä¹å¤„ã€‚",
              pinyin: "jiÃ ohuÃ¬ shÃ¬ gÃ¨ kuÃ ilÃ¨ chÃ¹",
              ko: "êµíšŒëŠ” ì¦ê±°ìš´ ê³³ì´ì—ìš”."
            }
          ],
          verses: [verses4[0], verses4[3]]
        },
        {
          id: "4-4",
          label: "4-4 (   )ëŠ” ëˆ„êµ¬ì˜ˆìš”?",
          description: "ì‚¬ëŒì„ ê°€ë¦¬í‚¤ëŠ” ë§ì„ ë„£ì–´ì„œ â€˜ëˆ„êµ¬ì˜ˆìš”?â€™ ë¬¸ì¥ì„ ë§Œë“¤ì–´ ë³´ì•„ìš”.",
          sentences: [
            {
              id: "4-4-1",
              zh: "ä½ æ˜¯è°ï¼Ÿ",
              pinyin: "nÇ shÃ¬ shÃ©i?",
              ko: "ë„ˆëŠ” ëˆ„êµ¬ë‹ˆ?"
            },
            {
              id: "4-4-2",
              zh: "ä»–æ˜¯è°ï¼Ÿ",
              pinyin: "tÄ shÃ¬ shÃ©i?",
              ko: "ê·¸ëŠ” ëˆ„êµ¬ì˜ˆìš”?"
            }
          ],
          verses: [verses4[2], verses4[5]]
        },
        {
          id: "4-5",
          label: "4-5 (   )ëŠ” ê¸°ë…êµì¸ì´ë‹¤",
          description: "ì‚¬ëŒì„ ë„£ì–´ì„œ â€˜(   )ëŠ” ê¸°ë…êµì¸ì´ë‹¤â€™ ë¬¸ì¥ì„ ë§Œë“¤ì–´ ë³´ì•„ìš”.",
          sentences: [
            {
              id: "4-5-1",
              zh: "æˆ‘æ˜¯åŸºç£å¾’ã€‚",
              pinyin: "wÇ’ shÃ¬ jÄ«dÅ«tÃº",
              ko: "ë‚˜ëŠ” ê¸°ë…êµì¸ì´ì—ìš”."
            }
          ],
          verses: [verses4[4], verses4[5]]
        },
        {
          id: "4-6",
          label: "4-6 ë‚˜ëŠ” (   )ì…ë‹ˆë‹¤",
          description: "ë‚´ ì •ì²´ì„±ì„ ë„£ì–´ â€˜ë‚˜ëŠ” (   )ì…ë‹ˆë‹¤â€™ ê³ ë°±í•´ ë³´ì•„ìš”.",
          sentences: [
            {
              id: "4-6-1",
              zh: "æˆ‘æ˜¯ç¥çš„å„¿å­ã€‚",
              pinyin: "wÇ’ shÃ¬ shÃ©n de Ã©rzi",
              ko: "ë‚˜ëŠ” í•˜ë‚˜ë‹˜ì˜ ì•„ë“¤ì´ì—ìš”."
            },
            {
              id: "4-6-2",
              zh: "æˆ‘æ˜¯ç¥çš„å¥³å„¿ã€‚",
              pinyin: "wÇ’ shÃ¬ shÃ©n de nÇš'Ã©r",
              ko: "ë‚˜ëŠ” í•˜ë‚˜ë‹˜ì˜ ë”¸ì´ì—ìš”."
            }
          ],
          verses: [verses4[4], verses4[5]]
        },
        {
          id: "4-7",
          label: "4-7 ì°¬ì–‘ ë³µìŠµ & ë‹¨ì–´ í€´ì¦ˆ",
          description: "ì°¬ì–‘ì„ ë‹¤ì‹œ ê³ ë°±í•˜ê³  ë‹¨ì–´Â·ëœ» ë§ì¶”ê¸° ê²Œì„ì„ í•´ìš”.",
          sentences: [
            {
              id: "4-7-1",
              zh: "å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„ï¼Œå“ˆåˆ©è·¯äºšã€‚",
              pinyin: "tiÄntÃ¡ng shÃ¬ gÃ¨ kuÃ ilÃ¨ chÃ¹, hÄlÃ¬lÃ¹yÃ ",
              ko: "ì²œêµ­ì€ ì¦ê±°ìš´ ê³³, í• ë ë£¨ì•¼."
            }
          ],
          verses: [verses4[0], verses4[1], verses4[3]]
        }
      ]
    };

    const modesBase4 = [
      { id: "study", label: "í•™ìŠµ ë¬¸ì¥" },
      { id: "flash", label: "í”Œë˜ì‹œ ì¹´ë“œ" },
      { id: "quiz",  label: "í€´ì¦ˆ" },
      { id: "verse", label: "ë§ì”€ ì¹´ë“œ" },
      { id: "song",  label: "ì°¬ì–‘ ë°°ìš°ê¸°" }
    ];

    function getStepModes(step) {
      if (!step) return ["study"];
      if (step.id === "4-1") return ["verse"];
      if (step.id === "4-2") return ["song", "study", "flash"];
      return ["study", "flash", "quiz", "verse"];
    }

    function getFlashVocab(step) {
      if (!step) return vocab4;
      if (step.id === "4-2" || step.id === "4-7") return vocab4;
      if (step.id === "4-3") return words43.map(w => ({ hanzi: w.zh, pinyin: w.pinyin, meaning: w.kr }));
      if (step.id === "4-4") return words44.map(w => ({ hanzi: w.zh, pinyin: w.pinyin, meaning: w.kr }));
      if (step.id === "4-5") return words45Subject.map(w => ({ hanzi: w.zh, pinyin: w.pinyin, meaning: w.kr }));
      if (step.id === "4-6") return words45.map(w => ({ hanzi: w.zh, pinyin: w.pinyin, meaning: w.kr }));
      return vocab4;
    }

    const builderMaps4 = {
      "4-3": {
        title: "(    )ì€ ì¦ê±°ìš´ ê³³ì´ì—ìš” Â· ë¬¸ì¥ ë§Œë“¤ê¸°",
        zhTemplate: '<span class="inline-highlight">ï¼ˆ      ï¼‰</span>æ˜¯ä¸ªå¿«ä¹å¤„ã€‚',
        koTemplate: '<span class="inline-highlight">(      )</span>ì€(ëŠ”) ì¦ê±°ìš´ ê³³ì´ì—ìš”.',
        zhPrefix: "",
        zhSuffix: "æ˜¯ä¸ªå¿«ä¹å¤„ã€‚",
        words: words43.map(w => ({
          labelKo: w.kr, zh: w.zh, pinyin: w.pinyin, meaning: w.meaning
        })),
        buildKo: (label) => `${label}ì€(ëŠ”) ì¦ê±°ìš´ ê³³ì´ì—ìš”.`
      },
      "4-4": {
        title: "(    )ëŠ” ëˆ„êµ¬ì˜ˆìš”? Â· ë¬¸ì¥ ë§Œë“¤ê¸°",
        zhTemplate: '<span class="inline-highlight">ï¼ˆ      ï¼‰</span>æ˜¯è°ï¼Ÿ',
        koTemplate: '<span class="inline-highlight">(      )</span>ëŠ”(ì€) ëˆ„êµ¬ì˜ˆìš”?',
        zhPrefix: "",
        zhSuffix: "æ˜¯è°ï¼Ÿ",
        words: words44.map(w => ({
          labelKo: w.kr, zh: w.zh, pinyin: w.pinyin, meaning: w.meaning
        })),
        buildKo: (label) => `${label}ëŠ”(ì€) ëˆ„êµ¬ì˜ˆìš”?`
      },
      "4-5": {
        title: "(    )ëŠ”(ì€) ê¸°ë…êµì¸ì´ë‹¤ Â· ë¬¸ì¥ ë§Œë“¤ê¸°",
        zhTemplate: '<span class="inline-highlight">ï¼ˆ      ï¼‰</span>æ˜¯åŸºç£å¾’ã€‚',
        koTemplate: '<span class="inline-highlight">(      )</span> ê¸°ë…êµì¸ì´ë‹¤.',
        zhPrefix: "",
        zhSuffix: "æ˜¯åŸºç£å¾’ã€‚",
        words: words45Subject.map(w => ({
          labelKo: w.subjKo, zh: w.zh, pinyin: w.pinyin, meaning: w.meaning
        })),
        buildKo: (labelSubj) => `${labelSubj} ê¸°ë…êµì¸ì´ë‹¤.`
      },
      "4-6": {
        title: "ë‚˜ëŠ” (    )ì…ë‹ˆë‹¤ Â· ë¬¸ì¥ ë§Œë“¤ê¸°",
        zhTemplate: 'æˆ‘æ˜¯<span class="inline-highlight">ï¼ˆ      ï¼‰</span>ã€‚',
        koTemplate: 'ë‚˜ëŠ” <span class="inline-highlight">(      )</span>ì…ë‹ˆë‹¤.',
        zhPrefix: "æˆ‘æ˜¯",
        zhSuffix: "ã€‚",
        words: words45.map(w => ({
          labelKo: w.kr, zh: w.zh, pinyin: w.pinyin, meaning: w.meaning
        })),
        buildKo: (label) => `ë‚˜ëŠ” ${label}ì…ë‹ˆë‹¤.`
      }
    };

    /* ===== 3. DOM & ìƒíƒœ ===== */
    const stepTabsEl = document.getElementById("step-tabs");
    const modeTabsEl = document.getElementById("mode-tabs");
    const contentEl  = document.getElementById("content");

    let currentStepId = "4-1";
    let currentModeId = "verse";

    function getCurrentStep() {
      return lesson4.steps.find(s => s.id === currentStepId);
    }

    /* ===== 4. ëª¨ë“œë³„ ë Œë”ë§ ===== */

    function renderStudy(step, c) {
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.label} Â· í•™ìŠµ ë¬¸ì¥</div>
        <div class="ko">${step.description || ""}</div>
      `;
      c.appendChild(intro);

      if (!step.sentences || !step.sentences.length) return;

      step.sentences.forEach((s, i) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="section-label">í•™ìŠµ ë¬¸ì¥ ${i + 1}</div>
          <div class="zh">${s.zh}</div>
          <div class="pinyin">${s.pinyin}</div>
          <div class="ko">${s.ko}</div>
          <div class="btn-row">
            <button id="study-once-${s.id}">í•œë²ˆ ë“£ê¸° â–¶</button>
            <button class="secondary" id="study-five-${s.id}">ë‹¤ì„¯ ë²ˆ ë“£ê¸° â–¶â–¶</button>
          </div>
        `;
        c.appendChild(card);
        document.getElementById(`study-once-${s.id}`).onclick = () => speakChineseOnce(s.zh);
        document.getElementById(`study-five-${s.id}`).onclick = () => speakChineseFive(s.zh);
      });
    }

    function renderFlash(step, c) {
      const vocab = getFlashVocab(step);
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.label} Â· í”Œë˜ì‹œ ì¹´ë“œ</div>
        <div class="ko">ì¹´ë“œë¥¼ ëˆŒëŸ¬ ì•/ë’·ë©´ì„ ë°”ê¾¸ê³ , ë‹¨ì–´ë¥¼ ì†Œë¦¬ ë‚´ì–´ ë”°ë¼ ë§í•´ ë³´ì•„ìš”.</div>
      `;
      c.appendChild(intro);

      if (!vocab || !vocab.length) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="ko">ì´ ë‹¨ê³„ì—ëŠ” í”Œë˜ì‹œ ì¹´ë“œ ë‹¨ì–´ê°€ ì—†ì–´ìš”.</div>`;
        c.appendChild(card);
        return;
      }

      const flashCard = document.createElement("div");
      flashCard.className = "card";
      flashCard.innerHTML = `
        <div class="flash-wrapper">
          <button class="arrow-btn" id="f-prev">â—€</button>
          <div class="flashcard" id="f-card">
            <div class="flash-counter" id="f-counter"></div>
            <div class="flash-face" id="f-face"></div>
          </div>
          <button class="arrow-btn" id="f-next">â–¶</button>
        </div>
        <div class="idx-text" id="f-idx"></div>
        <div class="btn-row">
          <button id="f-speak">ë‹¤ì‹œ ë“£ê¸° â–¶</button>
        </div>
      `;
      c.appendChild(flashCard);

      let fIndex = 0;
      let fFront = true;

      function drawFlash() {
        const v = vocab[fIndex];
        const face = document.getElementById("f-face");
        const counter = document.getElementById("f-counter");
        const idxText = document.getElementById("f-idx");
        const cardEl = document.getElementById("f-card");

        counter.textContent = `${fIndex + 1} / ${vocab.length}`;
        idxText.textContent = `${fIndex + 1} / ${vocab.length}`;

        if (fFront) {
          cardEl.classList.remove("back");
          face.innerHTML = `<div class="flash-front">${v.hanzi}</div>`;
          speakChineseOnce(v.hanzi);
        } else {
          cardEl.classList.add("back");
          face.innerHTML = `
            <div class="flash-back-main">${v.meaning}</div>
            <div class="flash-back-sub">${v.hanzi} Â· ${v.pinyin}</div>
          `;
        }
      }

      document.getElementById("f-card").onclick = () => {
        fFront = !fFront;
        drawFlash();
      };
      document.getElementById("f-prev").onclick = () => {
        fIndex = (fIndex - 1 + vocab.length) % vocab.length;
        fFront = true;
        drawFlash();
      };
      document.getElementById("f-next").onclick = () => {
        fIndex = (fIndex + 1) % vocab.length;
        fFront = true;
        drawFlash();
      };
      document.getElementById("f-speak").onclick = () => {
        const v = vocab[fIndex];
        speakChineseOnce(v.hanzi);
      };

      drawFlash();
    }

    function renderQuiz(step, c) {
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.label} Â· ë§í•˜ê¸° í€´ì¦ˆ</div>
        <div class="ko">ìš°ë¦¬ë§ íŒíŠ¸ë¥¼ ë³´ê³  ì¤‘êµ­ì–´ ë¬¸ì¥ì„ ë– ì˜¬ë ¤ ë³´ê³ , ì •ë‹µì„ ë“¤ì–´ ë³´ì•„ìš”.</div>
      `;
      c.appendChild(intro);

      /* ë¬¸ì¥ ë§Œë“¤ê¸° ë¯¸ë‹ˆì¹´ë“œ (4-3, 4-4, 4-5, 4-6) */
      const builder = builderMaps4[step.id];
      if (builder) {
        const bCard = document.createElement("div");
        bCard.className = "card";
        bCard.innerHTML = `
          <div class="section-label">${builder.title}</div>
          <div style="background:#e0f2fe; padding:12px 16px; border-radius:12px;">
            <div id="tmpl-zh-${step.id}" class="zh" style="font-size:36px; margin-bottom:6px;">
              ${builder.zhTemplate}
            </div>
            <div id="tmpl-ko-${step.id}" class="ko" style="margin:0;">
              ${builder.koTemplate}
            </div>
          </div>
          <div class="hint" style="margin-top:4px;">
            ì•„ë˜ <b>ì¹´ë“œ</b>ë¥¼ ëˆŒëŸ¬ ê´„í˜¸ ì•ˆì— ë“¤ì–´ê°ˆ ë§ì„ ê³¨ë¼ ë³´ì„¸ìš”.  
            ì„ íƒí•˜ë©´ ë¬¸ì¥ì´ ì™„ì„±ë˜ê³ , ì¤‘êµ­ì–´ë¡œ ì½ì–´ ì¤˜ìš”.
          </div>
          <div class="mini-card-container" id="mini-wrap-${step.id}"></div>
          <div class="zh" id="builder-zh-${step.id}" style="display:none; margin-top:16px;"></div>
          <div class="pinyin" id="builder-py-${step.id}" style="display:none;"></div>
          <div class="ko" id="builder-ko-${step.id}" style="display:none; font-size:22px;"></div>
          <div class="btn-row">
            <button id="builder-once-${step.id}">ë¬¸ì¥ í•œë²ˆ ë“£ê¸° â–¶</button>
            <button class="secondary" id="builder-five-${step.id}">ë‹¤ì„¯ ë²ˆ ë“£ê¸° â–¶â–¶</button>
          </div>
          <div class="hint" id="builder-status-${step.id}"></div>
        `;
        c.appendChild(bCard);

        const wrap = document.getElementById(`mini-wrap-${step.id}`);
        const tmplZhEl = document.getElementById(`tmpl-zh-${step.id}`);
        const tmplKoEl = document.getElementById(`tmpl-ko-${step.id}`);
        const zhEl = document.getElementById(`builder-zh-${step.id}`);
        const pyEl = document.getElementById(`builder-py-${step.id}`);
        const koEl = document.getElementById(`builder-ko-${step.id}`);
        const statusEl = document.getElementById(`builder-status-${step.id}`);

        let currentSentenceZh = "";

        builder.words.forEach(w => {
          const mc = document.createElement("div");
          mc.className = "mini-card";
          mc.innerHTML = `
            <div class="mini-card-title">${w.labelKo}</div>
            <div class="mini-card-zh">${w.zh}</div>
            <div class="mini-card-sub">${w.pinyin} Â· ${w.meaning}</div>
          `;
          mc.onclick = () => {
            const zhSentence = builder.zhPrefix
              ? `${builder.zhPrefix}${w.zh}${builder.zhSuffix}`
              : `${w.zh}${builder.zhSuffix}`;

            currentSentenceZh = zhSentence;

            const zhSpan = builder.zhPrefix
              ? `${builder.zhPrefix}<span class="inline-highlight">${w.zh}</span>${builder.zhSuffix}`
              : `<span class="inline-highlight">${w.zh}</span>${builder.zhSuffix}`;

            tmplZhEl.innerHTML = zhSpan;
            tmplKoEl.innerHTML = builder.koTemplate.replace("(      )", w.labelKo);

            zhEl.style.display = "block";
            pyEl.style.display = "block";
            koEl.style.display = "block";

            zhEl.textContent = zhSentence;
            pyEl.textContent = w.pinyin;
            koEl.textContent = builder.buildKo(w.labelKo);
            statusEl.textContent = "ì™„ì„±ëœ ë¬¸ì¥ì„ ì¤‘êµ­ì–´ë¡œ í•œ ë²ˆ ì½ì–´ ì¤„ê²Œìš”.";

            speakChineseOnce(zhSentence);
          };
          wrap.appendChild(mc);
        });

        document.getElementById(`builder-once-${step.id}`).onclick = () => {
          if (!currentSentenceZh) {
            statusEl.textContent = "ë¨¼ì € ì¹´ë“œë¥¼ ëˆŒëŸ¬ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.";
            return;
          }
          speakChineseOnce(currentSentenceZh);
        };
        document.getElementById(`builder-five-${step.id}`).onclick = () => {
          if (!currentSentenceZh) {
            statusEl.textContent = "ë¨¼ì € ì¹´ë“œë¥¼ ëˆŒëŸ¬ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.";
            return;
          }
          speakChineseFive(currentSentenceZh);
        };
      }

      /* ê¸°ë³¸ ë¬¸ì¥ í€´ì¦ˆ (í•œêµ­ì–´ íŒíŠ¸ â†’ ì •ë‹µ ë“£ê¸°) */
      if (step.sentences && step.sentences.length) {
        step.sentences.forEach((s, i) => {
          const q = document.createElement("div");
          q.className = "card";
          q.style.marginTop = "12px";
          q.innerHTML = `
            <div class="section-label">í€´ì¦ˆ ${i + 1}</div>
            <div class="ko">Q${i + 1}. <span class="inline-highlight">${s.ko}</span></div>
            <div class="btn-row">
              <button id="quiz-ans-${s.id}">ì •ë‹µ ë“£ê¸° â–¶</button>
              <button class="ghost" id="quiz-show-${s.id}">ì •ë‹µ ë³´ê¸°</button>
            </div>
            <div class="zh" id="quiz-zh-${s.id}" style="display:none; margin-top:10px;"></div>
          `;
          c.appendChild(q);

          document.getElementById(`quiz-ans-${s.id}`).onclick = () => {
            speakChineseOnce(s.zh);
            const zhEl = document.getElementById(`quiz-zh-${s.id}`);
            zhEl.style.display = "block";
            zhEl.textContent = `${s.zh} (${s.pinyin})`;
          };
          document.getElementById(`quiz-show-${s.id}`).onclick = () => {
            const zhEl = document.getElementById(`quiz-zh-${s.id}`);
            zhEl.style.display = "block";
            zhEl.textContent = `${s.zh} (${s.pinyin})`;
          };
        });
      }

      /* 4-7: ë‹¨ì–´Â·ëœ» ë§¤ì¹­ ê²Œì„ */
      if (step.id === "4-7") {
        const matchCard = document.createElement("div");
        matchCard.className = "card";
        matchCard.innerHTML = `
          <div class="section-label">ë‹¨ì–´ Â· ëœ» ë§¤ì¹­ ê²Œì„</div>
          <div class="ko">
            ì™¼ìª½ ì¤‘êµ­ì–´ ë‹¨ì–´ì™€ ì˜¤ë¥¸ìª½ ëœ»ì„ <b>ìˆœì„œëŒ€ë¡œ ëˆŒëŸ¬ì„œ</b> ì§ì„ ë§ì¶° ë³´ì•„ìš”.<br>
            ì •ë‹µì´ë©´ ì´ˆë¡ìƒ‰ì´ ë˜ê³ , ì¤‘êµ­ì–´ ë°œìŒë„ ë“¤ë ¤ì¤˜ìš”.
          </div>
          <div class="match-layout">
            <div class="match-col">
              <div class="section-label">ì¤‘êµ­ì–´</div>
              <div id="matchL"></div>
            </div>
            <div class="match-col">
              <div class="section-label">ëœ»</div>
              <div id="matchR"></div>
            </div>
          </div>
          <div class="hint" id="match-status" style="margin-top:10px;"></div>
        `;
        c.appendChild(matchCard);

        const leftWords = [
          { key: "å¤©å ‚", label: "å¤©å ‚" },
          { key: "æ˜¯", label: "æ˜¯" },
          { key: "ä¸ª", label: "ä¸ª" },
          { key: "å¿«ä¹", label: "å¿«ä¹" },
          { key: "å¤„", label: "å¤„" },
          { key: "å“ˆåˆ©è·¯äºš", label: "å“ˆåˆ©è·¯äºš" },
          { key: "åŸºç£å¾’", label: "åŸºç£å¾’" },
          { key: "å®¶", label: "å®¶" },
          { key: "æ•™ä¼š", label: "æ•™ä¼š" },
          { key: "å­¦æ ¡", label: "å­¦æ ¡" },
          { key: "è°", label: "è°" },
          { key: "æˆ‘", label: "æˆ‘" },
          { key: "ä½ ", label: "ä½ " }
        ];

        const rightWords = [
          { key: "å¤©å ‚", label: "ì²œêµ­" },
          { key: "æ˜¯", label: "~ì´ë‹¤" },
          { key: "ä¸ª", label: "(ì–‘ì‚¬: ê°œ)" },
          { key: "å¿«ä¹", label: "ì¦ê±°ìš´ / ê¸°ìœ" },
          { key: "å¤„", label: "ì¥ì†Œ / ê³³" },
          { key: "å“ˆåˆ©è·¯äºš", label: "í• ë ë£¨ì•¼" },
          { key: "åŸºç£å¾’", label: "ê¸°ë…êµì¸" },
          { key: "å®¶", label: "ì§‘" },
          { key: "æ•™ä¼š", label: "êµíšŒ" },
          { key: "í•™êµ", label: "í•™êµ" },
          { key: "è°", label: "ëˆ„êµ¬" },
          { key: "æˆ‘", label: "ë‚˜" },
          { key: "ä½ ", label: "ë„ˆ" }
        ];

        const L = document.getElementById("matchL");
        const R = document.getElementById("matchR");
        const status = document.getElementById("match-status");

        const leftItems = shuffleArray(leftWords);
        const rightItems = shuffleArray(rightWords);

        let selectedLeftKey = null;
        let solved = 0;
        const total = leftItems.length;

        leftItems.forEach(item => {
          const btn = document.createElement("button");
          btn.className = "match-btn";
          btn.textContent = item.label;
          btn.dataset.key = item.key;
          btn.onclick = () => {
            if (btn.classList.contains("correct")) return;
            L.querySelectorAll(".match-btn").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            selectedLeftKey = item.key;
            status.textContent = "ì´ì œ ì˜¤ë¥¸ìª½ì—ì„œ ëœ»ì„ ê³¨ë¼ ë³´ì•„ìš”.";
          };
          L.appendChild(btn);
        });

        rightItems.forEach(item => {
          const btn = document.createElement("button");
          btn.className = "match-btn";
          btn.textContent = item.label;
          btn.dataset.key = item.key;
          btn.onclick = () => {
            if (btn.classList.contains("correct")) return;
            if (!selectedLeftKey) {
              status.textContent = "ë¨¼ì € ì™¼ìª½ ë‹¨ì–´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.";
              return;
            }
            const leftBtn = L.querySelector(`.match-btn[data-key="${selectedLeftKey}"]`);
            if (!leftBtn) return;

            const leftKey = selectedLeftKey;
            const rightKey = item.key;

            if (leftKey === rightKey) {
              leftBtn.classList.remove("selected");
              leftBtn.classList.add("correct");
              btn.classList.add("correct");
              solved++;
              status.textContent = "ì •ë‹µì´ì—ìš”! ì˜í–ˆì–´ìš” ğŸ‘";
              speakChineseOnce(leftBtn.textContent);
              selectedLeftKey = null;
              if (solved === total) {
                status.textContent = "ëª¨ë“  ë‹¨ì–´ë¥¼ ë‹¤ ë§ì·„ì–´ìš”! ìµœê³ ì˜ˆìš” ğŸ‰";
              }
            } else {
              btn.classList.add("wrong");
              status.textContent = "ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ í•œ ë²ˆ ìƒê°í•´ ë³´ì!";
              setTimeout(() => {
                btn.classList.remove("wrong");
                L.querySelectorAll(".match-btn").forEach(b => b.classList.remove("selected"));
                selectedLeftKey = null;
              }, 600);
            }
          };
          R.appendChild(btn);
        });
      }
    }

    function renderVerse(step, c) {
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">${step.label} Â· ë§ì”€ ì¹´ë“œ</div>
        <div class="ko">${step.description || ""}</div>
      `;
      c.appendChild(intro);

      (step.verses || []).forEach(v => {
        const card = document.createElement("div");
        card.className = "card verse-card";
        card.innerHTML = `
          <div class="verse-ref">ğŸ“– ${v.ref}</div>
          <div class="verse-text">${v.text}</div>
        `;
        c.appendChild(card);
      });
    }

    function renderSong(step, c) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="section-label">${step.label} Â· ì°¬ì–‘ ì˜ìƒ</div>
        <h2>ì²œêµ­ì€ ì¦ê±°ìš´ ê³³ Â· å¤©å ‚æ˜¯ä¸ªå¿«ä¹å¤„</h2>
        <div class="video-wrapper">
          <iframe
            src="https://www.youtube.com/embed/${step.songVideoId || songVideoId4}"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen>
          </iframe>
        </div>
        <div class="hint">ì˜ìƒì„ ë³´ë©° ìœ¨ë™ê³¼ í•¨ê»˜ ììœ ë¡­ê²Œ ë”°ë¼ ë¶ˆëŸ¬ ë³´ì•„ìš”.</div>
      `;
      c.appendChild(card);

      if (step.sentences && step.sentences.length) {
        const lyric = document.createElement("div");
        lyric.className = "card";
        lyric.innerHTML = `<div class="section-label">í•µì‹¬ ê°€ì‚¬ & í‘œí˜„</div>`;
        step.sentences.forEach(s => {
          const block = document.createElement("div");
          block.style.marginBottom = "16px";
          block.innerHTML = `
            <div class="zh">${s.zh}</div>
            <div class="pinyin">${s.pinyin}</div>
            <div class="ko">${s.ko}</div>
            <div class="btn-row">
              <button>í•œë²ˆ ë“£ê¸° â–¶</button>
              <button class="secondary">ë‹¤ì„¯ ë²ˆ ë“£ê¸° â–¶â–¶</button>
            </div>
          `;
          const [btnOnce, btnFive] = block.querySelectorAll("button");
          btnOnce.onclick = () => speakChineseOnce(s.zh);
          btnFive.onclick = () => speakChineseFive(s.zh);
          lyric.appendChild(block);
        });
        c.appendChild(lyric);
      }
    }

    /* ===== 5. íƒ­ ë Œë”ë§ ===== */

    function renderStepTabs() {
      clear(stepTabsEl);
      lesson4.steps.forEach((step, idx) => {
        const b = document.createElement("button");
        b.className = "step-tab";
        if (step.id === currentStepId) b.classList.add("active");
        b.textContent = (idx + 1).toString();
        b.onclick = () => {
          currentStepId = step.id;
          const allowed = getStepModes(step);
          if (!allowed.includes(currentModeId)) {
            currentModeId = allowed[0];
          }
          renderStepTabs();
          renderModeTabs();
          renderContent();
        };
        stepTabsEl.appendChild(b);
      });
    }

    function renderModeTabs() {
      clear(modeTabsEl);
      const step = getCurrentStep();
      if (!step) return;

      const enabledIds = getStepModes(step);
      enabledIds.forEach(id => {
        const m = modesBase4.find(mm => mm.id === id);
        if (!m) return;
        const b = document.createElement("button");
        b.className = "mode-tab";
        if (m.id === currentModeId) b.classList.add("active");
        b.textContent = m.label;
        b.onclick = () => {
          currentModeId = m.id;
          renderModeTabs();
          renderContent();
        };
        modeTabsEl.appendChild(b);
      });
    }

    function renderContent() {
      clear(contentEl);
      const step = getCurrentStep();
      if (!step) return;

      const enabled = getStepModes(step);
      if (!enabled.includes(currentModeId)) {
        currentModeId = enabled[0];
        renderModeTabs();
      }

      if (currentModeId === "study") renderStudy(step, contentEl);
      else if (currentModeId === "flash") renderFlash(step, contentEl);
      else if (currentModeId === "quiz") renderQuiz(step, contentEl);
      else if (currentModeId === "verse") renderVerse(step, contentEl);
      else if (currentModeId === "song") renderSong(step, contentEl);
    }

    renderStepTabs();
    renderModeTabs();
    renderContent();
  </script>
</body>
</html>
