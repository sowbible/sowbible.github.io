<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>5ê³¼. ì§€ê¸ˆ ë‚´ê²Œ ê¸°ì¨ì´ ìˆì–´ìš” Â· ä»Šæˆ‘æœ‰å¿«ä¹</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      background: #f7f9fc;
      font-size: 24px;
      color: #111;
    }
    h1 {
      font-size: 48px;
      margin-bottom: 16px;
      color: #000;
    }

    /* ìƒë‹¨ íƒ­ (1~6) */
    .step-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }
    .step-tab {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #fed7aa;
      font-size: 24px;
      color: #7c2d12;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .step-tab.active {
      background: #f97316;
      color: #fff;
      box-shadow: 0 0 0 2px #ffedd5 inset;
    }

    .card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    .section-label {
      font-size: 20px;
      color: #374151;
      margin-bottom: 8px;
    }
    h2 {
      font-size: 34px;
      margin-bottom: 10px;
      color: #000;
    }

    .zh {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #b91c1c;
    }
    .pinyin {
      font-size: 28px;
      color: #444;
    }
    .ko {
      font-size: 28px;
      color: #222;
      margin-bottom: 14px;
      white-space: pre-line;
    }
    .hint {
      font-size: 22px;
      color: #555;
      margin-top: 10px;
    }

    button {
      padding: 10px 20px;
      font-size: 22px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 8px;
      background: #2563eb;
      color: white;
    }
    button.secondary { background: #10b981; }
    button.ghost { background: #e5e7eb; color: #1f2937; }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    /* ë§ì”€ ì¹´ë“œ */
    .verse-card {
      background: linear-gradient(135deg, #fef3c7, #e0f2fe);
      border-left: 6px solid #f97316;
    }
    .verse-ref {
      font-size: 26px;
      color: #555;
      margin-bottom: 8px;
    }
    .verse-text {
      font-size: 30px;
      white-space: pre-line;
      color: #111;
    }

    /* ìœ íŠœë¸Œ ì˜ìƒ */
    .video-wrapper {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      background: #000;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .video-wrapper iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    /* í”Œë˜ì‹œ ì¹´ë“œ */
    .flash-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 12px;
    }
    .flashcard {
      min-height: 220px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #ffedd5, #fed7aa);
      border-radius: 20px;
      cursor: pointer;
      text-align: center;
      padding: 24px;
      position: relative;
      transition: background 0.25s ease;
    }
    .flashcard.back {
      background: linear-gradient(135deg, #ecfdf5, #a5f3fc);
    }
    .flash-face {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    .flash-counter {
      position: absolute;
      top: 10px;
      left: 14px;
      font-size: 18px;
      color: #374151;
      background: rgba(255,255,255,0.8);
      padding: 2px 10px;
      border-radius: 999px;
    }
    .flash-front {
      font-size: 72px;
      font-weight: bold;
      color: #b91c1c;
    }
    .flash-back-main {
      font-size: 40px;
      font-weight: bold;
      color: #000;
      margin-bottom: 6px;
    }
    .flash-back-sub {
      font-size: 26px;
      color: #333;
    }
    .idx-text {
      font-size: 22px;
      margin-top: 6px;
      color: #444;
      text-align: center;
    }
    .arrow-btn {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      font-size: 28px;
      color: #374151;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* í•˜ì´ë¼ì´íŠ¸ */
    .inline-a {
      background: #fef08a;
      padding: 0 4px;
      border-radius: 6px;
      box-shadow: 0 0 0 2px #fef08a inset;
    }
    .inline-b {
      background: #bbf7d0;
      padding: 0 4px;
      border-radius: 6px;
      box-shadow: 0 0 0 2px #86efac inset;
    }

    /* ë¯¸ë‹ˆ ì¹´ë“œ (ë¬¸ì¥ ë§Œë“¤ê¸°) */
    .mini-card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }
    .mini-card {
      border-radius: 14px;
      padding: 10px 14px;
      min-width: 150px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(15,23,42,0.12);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    .mini-card-a {
      background: #fef08a;
    }
    .mini-card-b {
      background: #dcfce7;
    }
    .mini-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(15,23,42,0.16);
      filter: brightness(1.03);
    }
    .mini-card-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #111827;
    }
    .mini-card-zh {
      font-size: 26px;
      color: #b91c1c;
      margin-bottom: 2px;
    }
    .mini-card-sub {
      font-size: 18px;
      color: #4b5563;
    }

    /* ë‘ ì¤„ì§œë¦¬ ë¬¸ì¥ í…œí”Œë¦¿ ë°•ìŠ¤ */
    .template-box {
      background:#e0f2fe;
      padding:12px 16px;
      border-radius:12px;
      margin-bottom:8px;
    }

    /* íƒ­2 ì†Œíƒ­ ë²„íŠ¼ */
    .sub-mode-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin:8px 0 16px;
    }
    .sub-mode-btn {
      padding:8px 14px;
      border-radius:999px;
      border:none;
      font-size:20px;
      cursor:pointer;
      background:#e5e7eb;
      color:#111827;
    }
    .sub-mode-btn.active {
      background:#2563eb;
      color:#fff;
    }

    /* ë§¤ì¹­ ê²Œì„ */
    .match-layout {
      display: flex;
      gap: 16px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .match-col {
      flex: 1;
      min-width: 180px;
    }
    .match-btn {
      display: block;
      width: 100%;
      margin-bottom: 8px;
      padding: 8px 14px;
      font-size: 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      text-align: left;
      background: #e5e7eb;
      color: #111827;
      transition: background 0.12s ease, transform 0.12s ease;
    }
    .match-btn:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }
    .match-btn.selected {
      background: #fee2e2;
    }
    .match-btn.correct {
      background: #bbf7d0;
      cursor: default;
    }
    .match-btn.wrong {
      background: #fecaca;
    }
  </style>
</head>

<body>
  <h1>5ê³¼. ì§€ê¸ˆ ë‚´ê²Œ ê¸°ì¨ì´ ìˆì–´ìš” Â· ä»Šæˆ‘æœ‰å¿«ä¹</h1>

  <div id="step-tabs" class="step-tabs"></div>
  <div id="content"></div>

  <script>
    /* ===== 0. ê³µí†µ ìœ í‹¸ & ì¤‘êµ­ì–´ TTS ì„¤ì • ===== */

    const recordings = {};

    function clear(el) {
      while (el.firstChild) el.removeChild(el.firstChild);
    }

    // ---- ì¤‘êµ­ì–´ ìŒì„±(TTS) ì„¤ì • ----
    let zhVoices = [];
    let selectedZhVoice = null;

    function loadZhVoices() {
      if (!("speechSynthesis" in window)) {
        console.warn("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }

      const voices = window.speechSynthesis.getVoices();
      zhVoices = voices.filter(v =>
        (v.lang && v.lang.toLowerCase().startsWith("zh")) ||
        (v.lang && v.lang.toLowerCase().includes("hans")) ||
        (v.name && v.name.toLowerCase().includes("chinese"))
      );

      // ìš°ì„ ìˆœìœ„: zh-CN -> zh-... -> ë‚˜ë¨¸ì§€ Chinese
      selectedZhVoice =
        zhVoices.find(v => v.lang && v.lang.toLowerCase() === "zh-cn") ||
        zhVoices[0] ||
        null;
    }

    if ("speechSynthesis" in window) {
      loadZhVoices();
      window.speechSynthesis.onvoiceschanged = loadZhVoices;
    }

    function ensureChineseVoice() {
      if (!("speechSynthesis" in window)) {
        alert("ë¸Œë¼ìš°ì €ê°€ ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.");
        return false;
      }
      if (!selectedZhVoice) {
        alert(
          "ê¸°ê¸°ì—ì„œ ì¤‘êµ­ì–´ ìŒì„±ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”.\n" +
          "íœ´ëŒ€í°/ì»´í“¨í„° ì„¤ì •ì—ì„œ 'ì¤‘êµ­ì–´(æ™®é€šè¯/Chinese, China)' ìŒì„±ì„ ì„¤ì¹˜í•˜ê³ ,\n" +
          "í…ìŠ¤íŠ¸ ì½ê¸°(TTS) ê¸°ë³¸ ìŒì„±ìœ¼ë¡œ ì„ íƒí•´ ì£¼ì„¸ìš”."
        );
        return false;
      }
      return true;
    }

    function speakChineseOnce(text) {
      if (!ensureChineseVoice()) return;

      window.speechSynthesis.cancel();

      const u = new SpeechSynthesisUtterance(text);
      u.lang  = "zh-CN";
      u.voice = selectedZhVoice;
      u.rate  = 0.65;
      u.pitch = 1.0;

      window.speechSynthesis.speak(u);
    }

    function speakChineseRepeated(text) {
      if (!ensureChineseVoice()) return;

      window.speechSynthesis.cancel();
      let count = 0;

      function playOnce() {
        const u = new SpeechSynthesisUtterance(text);
        u.lang  = "zh-CN";
        u.voice = selectedZhVoice;
        u.rate  = 0.65;
        u.pitch = 1.0;

        u.onend = () => {
          count++;
          if (count < 5) {
            setTimeout(playOnce, 300);
          }
        };

        window.speechSynthesis.speak(u);
      }

      playOnce();
    }

    async function recordSentence(id, statusEl) {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë…¹ìŒì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.");
        return;
      }
      statusEl.textContent = "ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”. (ë¸Œë¼ìš°ì € ìƒë‹¨ í™•ì¸)";
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const rec = new MediaRecorder(stream);
        const chunks = [];
        rec.ondataavailable = e => chunks.push(e.data);
        rec.onstop = () => {
          const blob = new Blob(chunks, { type: "audio/webm" });
          recordings[id] = URL.createObjectURL(blob);
          statusEl.textContent = "ë…¹ìŒ ì™„ë£Œ! 'ë…¹ìŒ ë“£ê¸° â–¶'ë¥¼ ëˆŒëŸ¬ ë³´ì„¸ìš”.";
          stream.getTracks().forEach(t => t.stop());
        };
        rec.start();
        statusEl.textContent = "ë…¹ìŒ ì¤‘... ë”°ë¼ ë§í•´ ë³´ì„¸ìš”.";
        setTimeout(() => { if (rec.state !== "inactive") rec.stop(); }, 6000);
      } catch (e) {
        statusEl.textContent = "ë§ˆì´í¬ ê¶Œí•œì´ ê±°ì ˆë˜ì—ˆì–´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.";
      }
    }

    function playRecording(id) {
      if (!recordings[id]) {
        alert("ì•„ì§ ë…¹ìŒì´ ì—†ì–´ìš”.");
        return;
      }
      const audio = new Audio(recordings[id]);
      audio.play();
    }

    /* ===== 1. 5ê³¼ ë°ì´í„° ===== */

    const verses5 = [
      {
        ref: "í•˜ë°•êµ­ 3:18",
        textKo: "ë‚˜ëŠ” ì—¬í˜¸ì™€ë¡œ ë§ë¯¸ì•”ì•„ ì¦ê±°ì›Œí•˜ë©°\në‚˜ì˜ êµ¬ì›ì˜ í•˜ë‚˜ë‹˜ìœ¼ë¡œ ë§ë¯¸ì•”ì•„ ê¸°ë»í•˜ë¦¬ë¡œë‹¤"
      },
      {
        ref: "ì‹œí¸ 70:4",
        textKo: "ì£¼ë¥¼ ì°¾ëŠ” ëª¨ë“  ìë“¤ì´ ì£¼ë¡œ ë§ë¯¸ì•”ì•„ ê¸°ë»í•˜ê³  ì¦ê±°ì›Œí•˜ê²Œ í•˜ì‹œë©°\nì£¼ì˜ êµ¬ì›ì„ ì‚¬ë‘í•˜ëŠ” ìë“¤ì´ í•­ìƒ ë§í•˜ê¸°ë¥¼\nâ€˜í•˜ë‚˜ë‹˜ì€ ìœ„ëŒ€í•˜ì‹œë‹¤â€™ í•˜ê²Œ í•˜ì†Œì„œ"
      },
      {
        ref: "ìš”í•œë³µìŒ 15:11",
        textKo: "ë‚´ê°€ ì´ê²ƒì„ ë„ˆí¬ì—ê²Œ ì´ë¦„ì€ ë‚´ ê¸°ì¨ì´ ë„ˆí¬ ì•ˆì— ìˆì–´\në„ˆí¬ ê¸°ì¨ì„ ì¶©ë§Œí•˜ê²Œ í•˜ë ¤ í•¨ì´ë¼."
      }
    ];

    const songVideo5Id = "hyj6TH7FWjk";

    // íƒ­ 2 í”Œë˜ì‹œ ì¹´ë“œ ë‹¨ì–´
    const vocabTab2 = [
      { hanzi: "ä»Š", pinyin: "jÄ«n", meaning: "ì§€ê¸ˆ" },
      { hanzi: "æˆ‘", pinyin: "wÇ’", meaning: "ë‚˜" },
      { hanzi: "æœ‰", pinyin: "yÇ’u", meaning: "ìˆë‹¤/ê°€ì§€ë‹¤" },
      { hanzi: "å¿«ä¹", pinyin: "kuÃ ilÃ¨", meaning: "ê¸°ì¨, ì¦ê±°ì›€" },
      { hanzi: "åœ¨", pinyin: "zÃ i", meaning: "~ì— ìˆë‹¤" },
      { hanzi: "å¿ƒ", pinyin: "xÄ«n", meaning: "ë§ˆìŒ" },
      { hanzi: "ä¸­", pinyin: "zhÅng", meaning: "~ì•ˆ, ì†" },
      { hanzi: "æ°¸è¿œ", pinyin: "yÇ’ngyuÇn", meaning: "ì˜ì›íˆ" }
    ];

    // íƒ­ 3,4,5ìš© A/B ì„¸íŠ¸
    const subjectsAB = [
      { id: "wo",   zh: "æˆ‘",   pinyin: "wÇ’",      ko: "ë‚˜" },
      { id: "ni",   zh: "ä½ ",   pinyin: "nÇ",      ko: "ë„ˆ" },
      { id: "ta",   zh: "ä»–",   pinyin: "tÄ",      ko: "ê·¸" },
      { id: "taNv", zh: "å¥¹",   pinyin: "tÄ",      ko: "ê·¸ë…€" },
      { id: "women", zh: "æˆ‘ä»¬", pinyin: "wÇ’men", ko: "ìš°ë¦¬" },
      { id: "nimen", zh: "ä½ ä»¬", pinyin: "nÇmen",  ko: "ë„ˆí¬" },
      { id: "tamen", zh: "ä»–ä»¬", pinyin: "tÄmen",  ko: "ê·¸ë“¤" }
    ];

    const objectsAB = [
      { id: "happy",   zh: "å¿«ä¹",   pinyin: "kuÃ ilÃ¨",  ko: "ê¸°ì¨" },
      { id: "love",    zh: "çˆ±",     pinyin: "Ã i",      ko: "ì‚¬ë‘" },
      { id: "faith",   zh: "ä¿¡å¿ƒ",   pinyin: "xÃ¬nxÄ«n",  ko: "ë¯¿ìŒ" },
      { id: "courage", zh: "å‹‡æ°”",   pinyin: "yÇ’ngqÃ¬",  ko: "ìš©ê¸°" },

      { id: "rice",    zh: "é¥­",     pinyin: "fÃ n",     ko: "ë°¥" },
      { id: "noodle",  zh: "é¢",     pinyin: "miÃ n",    ko: "ë©´" },
      { id: "soup",    zh: "æ±¤",     pinyin: "tÄng",    ko: "íƒ•" },
      { id: "dumpling",zh: "é¥ºå­",   pinyin: "jiÇozi",  ko: "ë§Œë‘" },
      { id: "bread",   zh: "é¢åŒ…",   pinyin: "miÃ nbÄo", ko: "ë¹µ" },
      { id: "fruit",   zh: "æ°´æœ",   pinyin: "shuÇguÇ’", ko: "ê³¼ì¼" },
      { id: "vegi",    zh: "è”¬èœ",   pinyin: "shÅ«cÃ i",  ko: "ì±„ì†Œ" },
      { id: "water",   zh: "æ°´",     pinyin: "shuÇ",    ko: "ë¬¼" },
      { id: "drink",   zh: "é¥®æ–™",   pinyin: "yÇnliÃ o", ko: "ìŒë£Œìˆ˜" }
    ];

    /* ===== 2. ê° íƒ­ ë Œë” ===== */

    // íƒ­1: ë§ì”€ ì¹´ë“œ
    function renderTab1(container) {
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">5-1 ë§ì”€ & ê¸°ë„</div>
        <div class="ko">â€˜ì§€ê¸ˆ ë‚´ê²Œ ê¸°ì¨ì´ ìˆì–´ìš”â€™ë¼ëŠ” ê³ ë°±ê³¼ í•¨ê»˜\nê¸°ì¨ì— ëŒ€í•œ ë§ì”€ì„ ì½ì–´ ë³´ì•„ìš”.</div>
      `;
      container.appendChild(intro);

      verses5.forEach(v => {
        const card = document.createElement("div");
        card.className = "card verse-card";
        card.innerHTML = `
          <div class="verse-ref">ğŸ“– ${v.ref}</div>
          <div class="verse-text">${v.textKo}</div>
        `;
        container.appendChild(card);
      });
    }

    // íƒ­2: ì†Œíƒ­(ì°¬ì–‘ ë³´ê¸° / í•™ìŠµ ë¬¸ì¥ / ë§ì”€ ì¹´ë“œ) + í”Œë˜ì‹œì¹´ë“œ
    function renderTab2(container) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="sub-mode-row">
          <button class="sub-mode-btn active" id="sub-song">ì°¬ì–‘ ë³´ê¸°</button>
          <button class="sub-mode-btn" id="sub-study">í•™ìŠµ ë¬¸ì¥</button>
          <button class="sub-mode-btn" id="sub-verse">ë§ì”€ ì¹´ë“œ</button>
        </div>
        <div id="tab2-body"></div>
      `;
      container.appendChild(card);

      const body = document.getElementById("tab2-body");
      const btnSong = document.getElementById("sub-song");
      const btnStudy = document.getElementById("sub-study");
      const btnVerse = document.getElementById("sub-verse");

      function setActiveBtn(target) {
        [btnSong, btnStudy, btnVerse].forEach(b => b.classList.remove("active"));
        target.classList.add("active");
      }

      function renderSongView() {
        clear(body);
        const songBlock = document.createElement("div");
        songBlock.innerHTML = `
          <div class="video-wrapper">
            <iframe
              src="https://www.youtube.com/embed/${songVideo5Id}"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen>
            </iframe>
          </div>
          <div class="hint">ë¨¼ì € ì°¬ì–‘ì„ ì—¬ëŸ¬ ë²ˆ ë³´ë©´ì„œ, ë©œë¡œë””ì™€ ë¶„ìœ„ê¸°ë¥¼ ëŠê»´ ë´ìš”.</div>
        `;
        body.appendChild(songBlock);
      }

      function renderStudyView() {
        clear(body);

        // ì£¼ìš” ë¬¸ì¥
        const mainSentCard = document.createElement("div");
        mainSentCard.className = "card";
        mainSentCard.innerHTML = `
          <div class="section-label">ì£¼ìš” ë¬¸ì¥ ë”°ë¼ ë§í•˜ê¸°</div>
          <div class="ko">ì°¬ì–‘ì—ì„œ ë‚˜ì˜¤ëŠ” í•µì‹¬ ë¬¸ì¥ì„ ë“£ê³  ë”°ë¼ ë§í•´ ë³´ì„¸ìš”.</div>
        `;
        body.appendChild(mainSentCard);

        const mainSentences = [
          {
            id: "5-2-1",
            zh: "ä»Šæˆ‘æœ‰å¿«ä¹ã€‚",
            pinyin: "jÄ«n wÇ’ yÇ’u kuÃ ilÃ¨",
            ko: "ì§€ê¸ˆ ë‚´ê²Œ ê¸°ì¨ì´ ìˆì–´ìš”."
          },
          {
            id: "5-2-2",
            zh: "å¿«ä¹åœ¨æˆ‘å¿ƒä¸­ã€‚",
            pinyin: "kuÃ ilÃ¨ zÃ i wÇ’ xÄ«nzhÅng",
            ko: "ê¸°ì¨ì´ ë‚´ ë§ˆìŒ ê°€ìš´ë° ìˆì–´ìš”."
          },
          {
            id: "5-2-3",
            zh: "æ°¸è¿œåœ¨æˆ‘å¿ƒä¸­ã€‚",
            pinyin: "yÇ’ngyuÇn zÃ i wÇ’ xÄ«nzhÅng",
            ko: "ì˜ì›íˆ ë‚´ ë§ˆìŒì— ìˆì–´ìš”."
          }
        ];

        mainSentences.forEach((s, idx) => {
          const block = document.createElement("div");
          block.style.marginTop = "16px";
          block.innerHTML = `
            <div class="section-label">ë¬¸ì¥ ${idx + 1}</div>
            <div class="zh">${s.zh}</div>
            <div class="pinyin">${s.pinyin}</div>
            <div class="ko">${s.ko}</div>
            <div class="btn-row">
              <button id="once-${s.id}">í•œë²ˆ ë“£ê¸° â–¶</button>
              <button class="secondary" id="five-${s.id}">ë‹¤ì„¯ ë²ˆ ë“£ê¸° â–¶â–¶</button>
              <button class="secondary" id="rec-${s.id}">ë…¹ìŒí•˜ê¸° ğŸ¤</button>
              <button class="ghost" id="play-${s.id}">ë…¹ìŒ ë“£ê¸° â–¶</button>
            </div>
            <div class="hint" id="status-${s.id}">ë¬¸ì¥ì„ ë“£ê³  ì—¬ëŸ¬ ë²ˆ ë”°ë¼ ë§í•´ ë³´ì„¸ìš”.</div>
          `;
          mainSentCard.appendChild(block);

          document.getElementById(`once-${s.id}`).onclick = () => speakChineseOnce(s.zh);
          document.getElementById(`five-${s.id}`).onclick = () => speakChineseRepeated(s.zh);
          document.getElementById(`rec-${s.id}`).onclick = () => {
            recordSentence(s.id, document.getElementById(`status-${s.id}`));
          };
          document.getElementById(`play-${s.id}`).onclick = () => {
            playRecording(s.id);
          };
        });

        // í”Œë˜ì‹œ ì¹´ë“œ
        const flashCard = document.createElement("div");
        flashCard.className = "card";
        flashCard.innerHTML = `
          <div class="section-label">ë‹¨ì–´ í”Œë˜ì‹œ ì¹´ë“œ</div>
          <div class="ko">í•œìë¥¼ ì•ë©´, ëœ»ê³¼ ë³‘ìŒì„ ë’·ë©´ì—ì„œ ë³´ë©° ë‹¨ì–´ë¥¼ ìµí˜€ìš”.</div>
          <div class="flash-wrapper">
            <button class="arrow-btn" id="flash-prev">â—€</button>
            <div class="flashcard" id="flash-card">
              <div class="flash-counter" id="flash-counter"></div>
              <div class="flash-face" id="flash-face"></div>
            </div>
            <button class="arrow-btn" id="flash-next">â–¶</button>
          </div>
          <div class="idx-text" id="flash-idx"></div>
          <div class="btn-row">
            <button id="flash-speak">ë‹¤ì‹œ ë“£ê¸° â–¶</button>
            <button class="secondary" id="flash-rec">ë…¹ìŒí•˜ê¸° ğŸ¤</button>
            <button class="ghost" id="flash-play">ë…¹ìŒ ë“£ê¸° â–¶</button>
          </div>
          <div class="hint" id="flash-status">ì¹´ë“œë¥¼ ëˆŒëŸ¬ ì•/ë’·ë©´ì„ ë°”ê¾¸ì–´ ë³´ì„¸ìš”.</div>
        `;
        body.appendChild(flashCard);

        let fIdx = 0;
        let fFront = true;

        function drawFlash() {
          const v = vocabTab2[fIdx];
          const face = document.getElementById("flash-face");
          const counterEl = document.getElementById("flash-counter");
          const cardEl = document.getElementById("flash-card");
          const idxEl = document.getElementById("flash-idx");

          counterEl.textContent = `${fIdx + 1} / ${vocabTab2.length}`;
          idxEl.textContent = `${fIdx + 1} / ${vocabTab2.length}`;

          if (fFront) {
            cardEl.classList.remove("back");
            face.innerHTML = `<div class="flash-front">${v.hanzi}</div>`;
            speakChineseOnce(v.hanzi);
          } else {
            cardEl.classList.add("back");
            face.innerHTML = `
              <div class="flash-back-main">${v.meaning}</div>
              <div class="flash-back-sub">${v.hanzi} Â· ${v.pinyin}</div>
            `;
          }
        }

        document.getElementById("flash-card").onclick = () => {
          fFront = !fFront;
          drawFlash();
        };
        document.getElementById("flash-prev").onclick = () => {
          fIdx = (fIdx - 1 + vocabTab2.length) % vocabTab2.length;
          fFront = true;
          drawFlash();
        };
        document.getElementById("flash-next").onclick = () => {
          fIdx = (fIdx + 1) % vocabTab2.length;
          fFront = true;
          drawFlash();
        };
        document.getElementById("flash-speak").onclick = () => {
          const v = vocabTab2[fIdx];
          speakChineseOnce(v.hanzi);
        };
        document.getElementById("flash-rec").onclick = () => {
          const v = vocabTab2[fIdx];
          recordSentence("flash-5-" + v.hanzi, document.getElementById("flash-status"));
        };
        document.getElementById("flash-play").onclick = () => {
          const v = vocabTab2[fIdx];
          playRecording("flash-5-" + v.hanzi);
        };

        drawFlash();
      }

      function renderVerseView() {
        clear(body);
        const intro = document.createElement("div");
        intro.className = "card verse-card";
        intro.innerHTML = `
          <div class="verse-ref">ğŸ“– ê¸°ì¨ì— ëŒ€í•œ ë§ì”€</div>
          <div class="verse-text">
í•˜ë‚˜ë‹˜ê»˜ì„œ ì£¼ì‹œëŠ” ê¸°ì¨ì´ ë‚´ ë§ˆìŒì— ê°€ë“ ì°¨ë„ë¡,
ì°¬ì–‘ ê°€ì‚¬ì™€ ì—°ê²°ëœ ë§ì”€ì„ ë‹¤ì‹œ í•œ ë²ˆ ì½ì–´ ë³´ì•„ìš”.
          </div>
        `;
        body.appendChild(intro);

        verses5.forEach(v => {
          const card = document.createElement("div");
          card.className = "card verse-card";
          card.innerHTML = `
            <div class="verse-ref">ğŸ“– ${v.ref}</div>
            <div class="verse-text">${v.textKo}</div>
          `;
          body.appendChild(card);
        });
      }

      // ì´ˆê¸°: ì°¬ì–‘ ë³´ê¸°
      renderSongView();

      btnSong.onclick = () => {
        setActiveBtn(btnSong);
        renderSongView();
      };
      btnStudy.onclick = () => {
        setActiveBtn(btnStudy);
        renderStudyView();
      };
      btnVerse.onclick = () => {
        setActiveBtn(btnVerse);
        renderVerseView();
      };
    }

    /* ê³µí†µ: A/B êµ¬ì¡° ë¬¸ì¥ ë§Œë“¤ê¸° ë Œë”ëŸ¬ */
    function renderABSentenceTab(container, config) {
      const { stepLabel, type, sentenceIdPrefix } = config;

      const outer = document.createElement("div");
      outer.className = "card";
      outer.innerHTML = `
        <div class="section-label">${stepLabel} Â· ë¬¸ì¥ ë§Œë“¤ê¸°</div>
        <div class="template-box">
          <div id="tmpl-zh-${sentenceIdPrefix}" class="zh" style="font-size:40px; margin-bottom:6px;"></div>
          <div id="tmpl-ko-${sentenceIdPrefix}" class="ko" style="margin:0;"></div>
        </div>
        <div class="hint">
          ìœ„ì˜ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³¼ê²Œìš”.<br>
          <span class="inline-a">A (ë…¸ë‘ ì¹´ë“œ)</span>ëŠ” <b>ëˆ„ê°€?</b>, 
          <span class="inline-b">B (ì´ˆë¡ ì¹´ë“œ)</span>ëŠ” <b>ë¬´ì—‡?</b>ì„ ë‚˜íƒ€ë‚´ìš”.
        </div>

        <div class="card" style="margin-top:14px; background:#f9fafb;">
          <div class="section-label">â‘  A: ëˆ„ê°€? (ì£¼ì–´)</div>
          <div class="mini-card-container" id="mini-subj-${sentenceIdPrefix}"></div>
        </div>

        <div class="card" style="margin-top:10px; background:#f9fafb;">
          <div class="section-label">â‘¡ B: ë¬´ì—‡? (ë‚´ìš©)</div>
          <div class="mini-card-container" id="mini-obj-${sentenceIdPrefix}"></div>
        </div>

        <div class="card" style="margin-top:16px;">
          <div class="section-label">ì™„ì„±ëœ ë¬¸ì¥</div>
          <div class="zh" id="out-zh-${sentenceIdPrefix}" style="display:none;"></div>
          <div class="pinyin" id="out-py-${sentenceIdPrefix}" style="display:none;"></div>
          <div class="ko" id="out-ko-${sentenceIdPrefix}" style="display:none; font-size:24px;"></div>
          <div class="btn-row">
            <button class="secondary" id="btn-read-${sentenceIdPrefix}">ì¤‘êµ­ì–´ ë‹¤ì‹œ ë“£ê¸° â–¶</button>
            <button class="secondary" id="btn-rec-${sentenceIdPrefix}">ë…¹ìŒí•˜ê¸° ğŸ¤</button>
            <button class="ghost" id="btn-play-${sentenceIdPrefix}">ë…¹ìŒ ë“£ê¸° â–¶</button>
          </div>
          <div class="hint" id="status-${sentenceIdPrefix}">
            Aì™€ Bë¥¼ ëª¨ë‘ ê³ ë¥´ë©´ ìë™ìœ¼ë¡œ ì¤‘êµ­ì–´ ë¬¸ì¥ì´ ì½í˜€ìš”.
          </div>
        </div>
      `;
      container.appendChild(outer);

      const tmplZhEl = document.getElementById(`tmpl-zh-${sentenceIdPrefix}`);
      const tmplKoEl = document.getElementById(`tmpl-ko-${sentenceIdPrefix}`);
      const subjWrap = document.getElementById(`mini-subj-${sentenceIdPrefix}`);
      const objWrap = document.getElementById(`mini-obj-${sentenceIdPrefix}`);
      const outZhEl = document.getElementById(`out-zh-${sentenceIdPrefix}`);
      const outPyEl = document.getElementById(`out-py-${sentenceIdPrefix}`);
      const outKoEl = document.getElementById(`out-ko-${sentenceIdPrefix}`);
      const statusEl = document.getElementById(`status-${sentenceIdPrefix}`);

      function setInitialTemplate() {
        if (type === "have") {
          tmplZhEl.innerHTML = `<span class="inline-a">(   )</span>æœ‰<span class="inline-b">(   )</span>ã€‚`;
          tmplKoEl.innerHTML = `<span class="inline-a">(   )</span>ëŠ”(ì€) <span class="inline-b">(   )</span>ì´/ê°€ ìˆì–´ìš”.`;
        } else if (type === "nothave") {
          tmplZhEl.innerHTML = `<span class="inline-a">(   )</span>æ²¡æœ‰<span class="inline-b">(   )</span>ã€‚`;
          tmplKoEl.innerHTML = `<span class="inline-a">(   )</span>ëŠ”(ì€) <span class="inline-b">(   )</span>ì´/ê°€ ì—†ì–´ìš”.`;
        } else if (type === "question") {
          tmplZhEl.innerHTML = `<span class="inline-a">(   )</span>æœ‰<span class="inline-b">(   )</span>å—ï¼Ÿ`;
          tmplKoEl.innerHTML = `<span class="inline-a">(   )</span>ëŠ”(ì€) <span class="inline-b">(   )</span>ì´/ê°€ ìˆë‹ˆ?`;
        }
      }
      setInitialTemplate();

      let selectedSubj = null;
      let selectedObj = null;
      let lastSentenceZh = "";

      function updateTemplateAndOutput() {
        let subjTextZh = selectedSubj ? selectedSubj.zh : "(   )";
        let subjTextKo = selectedSubj ? selectedSubj.ko : "(   )";
        let objTextZh  = selectedObj ? selectedObj.zh  : "(   )";
        let objTextKo  = selectedObj ? selectedObj.ko  : "(   )";

        if (type === "have") {
          tmplZhEl.innerHTML =
            `<span class="inline-a">${subjTextZh}</span>æœ‰` +
            `<span class="inline-b">${objTextZh}</span>ã€‚`;
          tmplKoEl.innerHTML =
            `<span class="inline-a">${subjTextKo}</span>ëŠ”(ì€) ` +
            `<span class="inline-b">${objTextKo}</span>ì´/ê°€ ìˆì–´ìš”.`;
        } else if (type === "nothave") {
          tmplZhEl.innerHTML =
            `<span class="inline-a">${subjTextZh}</span>æ²¡æœ‰` +
            `<span class="inline-b">${objTextZh}</span>ã€‚`;
          tmplKoEl.innerHTML =
            `<span class="inline-a">${subjTextKo}</span>ëŠ”(ì€) ` +
            `<span class="inline-b">${objTextKo}</span>ì´/ê°€ ì—†ì–´ìš”.`;
        } else if (type === "question") {
          tmplZhEl.innerHTML =
            `<span class="inline-a">${subjTextZh}</span>æœ‰` +
            `<span class="inline-b">${objTextZh}</span>å—ï¼Ÿ`;
          tmplKoEl.innerHTML =
            `<span class="inline-a">${subjTextKo}</span>ëŠ”(ì€) ` +
            `<span class="inline-b">${objTextKo}</span>ì´/ê°€ ìˆë‹ˆ?`;
        }

        if (!selectedSubj || !selectedObj) {
          outZhEl.style.display = "none";
          outPyEl.style.display = "none";
          outKoEl.style.display = "none";
          return;
        }

        let zhSentence = "";
        let pySentence = "";

        if (type === "have") {
          zhSentence = `${selectedSubj.zh}æœ‰${selectedObj.zh}ã€‚`;
          pySentence = `${selectedSubj.pinyin} yÇ’u ${selectedObj.pinyin}`;
        } else if (type === "nothave") {
          zhSentence = `${selectedSubj.zh}æ²¡æœ‰${selectedObj.zh}ã€‚`;
          pySentence = `${selectedSubj.pinyin} mÃ©iyÇ’u ${selectedObj.pinyin}`;
        } else if (type === "question") {
          zhSentence = `${selectedSubj.zh}æœ‰${selectedObj.zh}å—ï¼Ÿ`;
          pySentence = `${selectedSubj.pinyin} yÇ’u ${selectedObj.pinyin} ma?`;
        }

        let koSentence = "";
        if (type === "have") {
          koSentence = `${selectedSubj.ko}ëŠ”(ì€) ${selectedObj.ko}ì´/ê°€ ìˆì–´ìš”.`;
        } else if (type === "nothave") {
          koSentence = `${selectedSubj.ko}ëŠ”(ì€) ${selectedObj.ko}ì´/ê°€ ì—†ì–´ìš”.`;
        } else if (type === "question") {
          koSentence = `${selectedSubj.ko}ëŠ”(ì€) ${selectedObj.ko}ì´/ê°€ ìˆë‹ˆ?`;
        }

        outZhEl.style.display = "block";
        outPyEl.style.display = "block";
        outKoEl.style.display = "block";

        outZhEl.textContent = zhSentence;
        outPyEl.textContent = pySentence;
        outKoEl.textContent = koSentence;

        lastSentenceZh = zhSentence;
        speakChineseOnce(zhSentence);
      }

      subjectsAB.forEach(s => {
        const card = document.createElement("div");
        card.className = "mini-card mini-card-a";
        card.innerHTML = `
          <div class="mini-card-title">${s.ko}</div>
          <div class="mini-card-zh">${s.zh}</div>
          <div class="mini-card-sub">${s.pinyin}</div>
        `;
        card.onclick = () => {
          selectedSubj = s;
          subjWrap.querySelectorAll(".mini-card").forEach(el => {
            el.style.outline = "none";
          });
          card.style.outline = "3px solid #2563eb";
          updateTemplateAndOutput();
        };
        subjWrap.appendChild(card);
      });

      objectsAB.forEach(o => {
        const card = document.createElement("div");
        card.className = "mini-card mini-card-b";
        card.innerHTML = `
          <div class="mini-card-title">${o.ko}</div>
          <div class="mini-card-zh">${o.zh}</div>
          <div class="mini-card-sub">${o.pinyin}</div>
        `;
        card.onclick = () => {
          selectedObj = o;
          objWrap.querySelectorAll(".mini-card").forEach(el => {
            el.style.outline = "none";
          });
          card.style.outline = "3px solid #22c55e";
          updateTemplateAndOutput();
        };
        objWrap.appendChild(card);
      });

      document.getElementById(`btn-read-${sentenceIdPrefix}`).onclick = () => {
        if (!lastSentenceZh) {
          statusEl.textContent = "ë¨¼ì € Aì™€ Bë¥¼ ê³¨ë¼ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.";
          return;
        }
        speakChineseOnce(lastSentenceZh);
      };
      document.getElementById(`btn-rec-${sentenceIdPrefix}`).onclick = () => {
        recordSentence(`5-${sentenceIdPrefix}`, statusEl);
      };
      document.getElementById(`btn-play-${sentenceIdPrefix}`).onclick = () => {
        playRecording(`5-${sentenceIdPrefix}`);
      };
    }

    // íƒ­3: æˆ‘æœ‰( ) â€” ë‚˜ëŠ” ( )ì´ ìˆì–´ìš”
    function renderTab3(container) {
      renderABSentenceTab(container, {
        stepLabel: "5-3 ë‚˜ëŠ” (   )ì´ ìˆì–´ìš”",
        type: "have",
        sentenceIdPrefix: "5-3"
      });
    }

    // íƒ­4: æˆ‘æ²¡æœ‰( ) â€” ë‚˜ëŠ” ( )ì´ ì—†ì–´ìš”
    function renderTab4(container) {
      renderABSentenceTab(container, {
        stepLabel: "5-4 ë‚˜ëŠ” (   )ì´ ì—†ì–´ìš”",
        type: "nothave",
        sentenceIdPrefix: "5-4"
      });
    }

    // íƒ­5: ä½ æœ‰( )å—? â€” (   )ëŠ” (   )ì´ ìˆë‹ˆ?
    function renderTab5(container) {
      renderABSentenceTab(container, {
        stepLabel: "5-5 (   )ëŠ” (   )ì´ ìˆë‹ˆ?",
        type: "question",
        sentenceIdPrefix: "5-5"
      });
    }

    // íƒ­6: ì°¬ì–‘ ë³µìŠµ í€´ì¦ˆ + ë‹¨ì–´â€“ëœ» ë§¤ì¹­ ê²Œì„
    function renderTab6(container) {
      const intro = document.createElement("div");
      intro.className = "card";
      intro.innerHTML = `
        <div class="section-label">5-6 ì°¬ì–‘ ë³µìŠµ Â· ë§í•˜ê¸° í€´ì¦ˆ</div>
        <div class="ko">
          ì°¬ì–‘ì—ì„œ ë‚˜ì™”ë˜ ìš°ë¦¬ë§ ë¬¸ì¥ì„ ë³´ê³ , ì¤‘êµ­ì–´ë¡œ ë§í•´ ë³´ì„¸ìš”.<br>
          í•„ìš”í•˜ë©´ ë…¹ìŒí•´ ë³´ê³ , â€˜ì •ë‹µ ë“£ê¸°â€™ë¡œ í™•ì¸í•´ìš”.
        </div>
      `;
      container.appendChild(intro);

      const quizItems = [
        {
          id: "5-6-1",
          ko: "ì§€ê¸ˆ ë‚´ê²Œ ê¸°ì¨ì´ ìˆì–´ìš”.",
          zh: "ä»Šæˆ‘æœ‰å¿«ä¹ã€‚",
          py: "jÄ«n wÇ’ yÇ’u kuÃ ilÃ¨"
        },
        {
          id: "5-6-2",
          ko: "ê¸°ì¨ì´ ë‚´ ë§ˆìŒ ê°€ìš´ë° ìˆì–´ìš”.",
          zh: "å¿«ä¹åœ¨æˆ‘å¿ƒä¸­ã€‚",
          py: "kuÃ ilÃ¨ zÃ i wÇ’ xÄ«nzhÅng"
        },
        {
          id: "5-6-3",
          ko: "ì˜ì›íˆ ë‚´ ë§ˆìŒì— ìˆì–´ìš”.",
          zh: "æ°¸è¿œåœ¨æˆ‘å¿ƒä¸­ã€‚",
          py: "yÇ’ngyuÇn zÃ i wÇ’ xÄ«nzhÅng"
        }
      ];

      quizItems.forEach((q, idx) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="section-label">í€´ì¦ˆ ${idx + 1}</div>
          <div class="ko">Q. ${q.ko}</div>
          <div class="btn-row">
            <button class="secondary" id="quiz-rec-${q.id}">ì¤‘êµ­ì–´ë¡œ ë§í•˜ê¸° ğŸ¤</button>
            <button class="ghost" id="quiz-play-${q.id}">ë…¹ìŒ ë“£ê¸° â–¶</button>
            <button id="quiz-ans-${q.id}">ì •ë‹µ ë“£ê¸° â–¶</button>
          </div>
          <div class="zh" id="quiz-zh-${q.id}" style="display:none; margin-top:10px;"></div>
          <div class="pinyin" id="quiz-py-${q.id}" style="display:none;"></div>
          <div class="hint" id="quiz-status-${q.id}"></div>
        `;
        container.appendChild(card);

        document.getElementById(`quiz-rec-${q.id}`).onclick = () => {
          recordSentence("quiz-" + q.id, document.getElementById(`quiz-status-${q.id}`));
        };
        document.getElementById(`quiz-play-${q.id}`).onclick = () => {
          playRecording("quiz-" + q.id);
        };
        document.getElementById(`quiz-ans-${q.id}`).onclick = () => {
          speakChineseOnce(q.zh);
          const zhEl = document.getElementById(`quiz-zh-${q.id}`);
          const pyEl = document.getElementById(`quiz-py-${q.id}`);
          zhEl.style.display = "block";
          pyEl.style.display = "block";
          zhEl.textContent = q.zh;
          pyEl.textContent = q.py;
        };
      });

      const matchCard = document.createElement("div");
      matchCard.className = "card";
      matchCard.innerHTML = `
        <div class="section-label">5-6 ë‹¨ì–´ Â· ëœ» ë§¤ì¹­ ê²Œì„</div>
        <div class="ko">
          ì™¼ìª½ ì¤‘êµ­ì–´ ë‹¨ì–´ì™€ ì˜¤ë¥¸ìª½ ìš°ë¦¬ë§ ëœ»ì„ ìˆœì„œëŒ€ë¡œ ëˆŒëŸ¬ì„œ ì§ì„ ë§ì¶° ë³´ì„¸ìš”.<br>
          ì •ë‹µì´ë©´ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë³€í•˜ê³ , ë°œìŒë„ ë“¤ë ¤ì¤„ê²Œìš”.
        </div>
        <div class="match-layout">
          <div class="match-col" id="match-left-5"></div>
          <div class="match-col" id="match-right-5"></div>
        </div>
        <div class="hint" id="match-status-5" style="margin-top:12px;"></div>
      `;
      container.appendChild(matchCard);

      const leftEl = document.getElementById("match-left-5");
      const rightEl = document.getElementById("match-right-5");
      const statusEl = document.getElementById("match-status-5");

      const leftItems = [
        { key: "ä»Š", label: "ä»Š" },
        { key: "æˆ‘", label: "æˆ‘" },
        { key: "æœ‰", label: "æœ‰" },
        { key: "å¿«ä¹", label: "å¿«ä¹" },
        { key: "åœ¨", label: "åœ¨" },
        { key: "å¿ƒ", label: "å¿ƒ" },
        { key: "ä¸­", label: "ä¸­" },
        { key: "æ°¸è¿œ", label: "æ°¸è¿œ" }
      ];

      const rightItems = [
        { key: "ä¸­", label: "~ì•ˆ, ì†" },
        { key: "æœ‰", label: "ìˆë‹¤/ê°€ì§€ë‹¤" },
        { key: "ä»Š", label: "ì§€ê¸ˆ" },
        { key: "åœ¨", label: "~ì— ìˆë‹¤" },
        { key: "æˆ‘", label: "ë‚˜" },
        { key: "å¿«ä¹", label: "ê¸°ì¨, ì¦ê±°ì›€" },
        { key: "å¿ƒ", label: "ë§ˆìŒ" },
        { key: "æ°¸è¿œ", label: "ì˜ì›íˆ" }
      ];

      let completed = 0;
      const total = leftItems.length;

      leftItems.forEach(item => {
        const btn = document.createElement("button");
        btn.className = "match-btn";
        btn.textContent = item.label;
        btn.dataset.key = item.key;
        btn.onclick = () => {
          if (btn.classList.contains("correct")) return;
          document.querySelectorAll("#match-left-5 .match-btn").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          statusEl.textContent = "ì´ì œ ì˜¤ë¥¸ìª½ì—ì„œ ëœ»ì„ ê³¨ë¼ ë³´ì„¸ìš”.";
        };
        leftEl.appendChild(btn);
      });

      rightItems.forEach(item => {
        const btn = document.createElement("button");
        btn.className = "match-btn";
        btn.textContent = item.label;
        btn.dataset.key = item.key;
        btn.onclick = () => {
          if (btn.classList.contains("correct")) return;

          const leftSelectedBtn = document.querySelector("#match-left-5 .match-btn.selected");
          if (!leftSelectedBtn) {
            statusEl.textContent = "ë¨¼ì € ì™¼ìª½ ë‹¨ì–´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.";
            return;
          }
          const leftKey = leftSelectedBtn.dataset.key;
          const rightKey = item.key;

          if (leftKey === rightKey) {
            leftSelectedBtn.classList.remove("selected");
            leftSelectedBtn.classList.add("correct");
            btn.classList.add("correct");
            completed++;
            statusEl.textContent = "ì •ë‹µì´ì—ìš”! ğŸ‘";

            speakChineseOnce(leftKey);

            if (completed === total) {
              statusEl.textContent = "ëª¨ë“  ë‹¨ì–´ë¥¼ ë‹¤ ë§ì·„ì–´ìš”! ë„ˆë¬´ ì˜í–ˆì–´ìš” ğŸ‰";
            }
          } else {
            btn.classList.add("wrong");
            statusEl.textContent = "ì¡°ê¸ˆ ì•„ì‰¬ì›Œìš”. ë‹¤ì‹œ í•œ ë²ˆ ë„ì „í•´ ë³´ì!";
            setTimeout(() => {
              btn.classList.remove("wrong");
              if (leftSelectedBtn) leftSelectedBtn.classList.remove("selected");
            }, 600);
          }
        };
        rightEl.appendChild(btn);
      });
    }

    /* ===== 3. íƒ­ ê´€ë¦¬ ===== */

    const steps5 = [
      { id: "5-1", label: "1" },
      { id: "5-2", label: "2" },
      { id: "5-3", label: "3" },
      { id: "5-4", label: "4" },
      { id: "5-5", label: "5" },
      { id: "5-6", label: "6" }
    ];

    let currentStepId = "5-1";

    const stepTabsEl = document.getElementById("step-tabs");
    const contentEl = document.getElementById("content");

    function renderStepTabs() {
      clear(stepTabsEl);
      steps5.forEach(step => {
        const b = document.createElement("button");
        b.className = "step-tab";
        if (step.id === currentStepId) b.classList.add("active");
        b.textContent = step.label;
        b.onclick = () => {
          currentStepId = step.id;
          renderStepTabs();
          renderContent();
        };
        stepTabsEl.appendChild(b);
      });
    }

    function renderContent() {
      clear(contentEl);
      if (currentStepId === "5-1") renderTab1(contentEl);
      else if (currentStepId === "5-2") renderTab2(contentEl);
      else if (currentStepId === "5-3") renderTab3(contentEl);
      else if (currentStepId === "5-4") renderTab4(contentEl);
      else if (currentStepId === "5-5") renderTab5(contentEl);
      else if (currentStepId === "5-6") renderTab6(contentEl);
    }

    renderStepTabs();
    renderContent();
  </script>
</body>
</html>
